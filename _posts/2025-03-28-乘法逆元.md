---
layout: page
tags: 数论
image: /assets/image/7.jpeg
description: xxxxxxxxxxxxxxxxxx
author: pk
title: 乘法逆元
categories: [计算机, 数据结构与算法]
---

# 概述

若 $ax \equiv 1 (mod\ p)$，则称 $x$ 为 $a$ 关于模 $p$ 的逆元，记为 $a^{-1}$ 。

- $1$ 的逆元永远是 $1$​，$0$​ 不存在逆元
- $gcd(a, p) \neq 1$ 时，逆元不存在（ $a \% p == 0$ 或 $p \% a == 0$ ）



$p$ 一般为比较大的素数



可以用扩展欧几里得定理解释：$ax \equiv 1 (mod\ p)  \Leftrightarrow ax + py = 1$ 有整数解 $\Leftrightarrow  gcd(a, p) = 1$



# 扩展欧几里德

**不要求 $p$ 为素数，但要求 $a$ 、$p$ 互质**

使用扩展欧几里德算法求解 $ax + py = 1$，得到一组特解的 $x$ 即为 $a$ 的逆元。

```cpp
// ax + by = gcd(a, b)
pair<long long, long long> exgcd(long long a, long long b) {
    if(b == 0) return {1, 0};
    auto [x, y] = exgcd(b, a % b);
    return {y, x - a / b * y};
}
```



# 快速幂

费马小定理重要推论：当 $a$ 不能被质数 $p$ 整除时，有 $a^{p - 1} \equiv 1 (mod p)$ 



根据 $ax\ \equiv\ 1 \equiv\ a^{p - 1} (mod\ p)$，有：
$$
x \equiv a^{p - 2} \ (mod\ p)
$$


**要求 $p$ 为素数**

```cpp
int qpow(int a,int p) {
    int b = p - 2, res = 1;
    while(b) {
        if(b & 1) res = res * a % p;
        a = a * a % p;
        b >>= 1;
    }
    return res;
}
```



# 线性求逆元



适用于大范围求解逆元，要求 $p$ 为素数。

设： 
$$
p = ka + b(k = p / a, b = p \% a)
$$
则有：
$$
ka + b \equiv 0 (mod\ p)
$$
两边同时乘以 $a^{-1}$ 和 $b^{-1}$：
$$
kb^{-1} + a^{-1} \equiv 0\ (mod\ p）\\
a^{-1} \equiv -kb^{-1}\ (mod\ p) \\
a^{-1} \equiv -(p\ /\ a)(p\ \%\ a)^{-1}\ (mod\ p)
$$



**要求 $p$ 为素数**

```cpp
//要求 p 为素数，否则[1, p) 之间有的数不存在逆元
//假设 p 不为素数，p % a == 0，a 就没有逆元了
vector<int> mmi_linear(int p) {
    vector<int> inv(p);
    inv[1] = 1;
    for(int i = 2; i < p; ++i) {
        //使逆元保证为正数
        inv[i] = (p - p / i) * inv[p % i] % p;
    }
    return inv;
}
```



# 练习

[Codeforces Round 874 (Div. 3) F. Ira and Flamenco](https://codeforces.com/contest/1833/problem/F)

已知若干个数相乘 $mod$ $p$ 的值 $x$，求：去掉其中一个数 $num$，求剩余数的乘积 $mod$  $p$ 的结果？

- “给 $x$ 乘以 $num$ 的逆元”，也就抵消了 $num$ 的作用（也就是去掉了 $num$）