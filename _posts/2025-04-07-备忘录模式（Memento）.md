---
layout: page
image: /assets/image/41.jpeg
description: xxxxxxxxxxxxxxxxxx
author: pk
title: 备忘录模式（Memento）
categories: [计算机, 设计模式]
---

# 概述

拷贝个副本不就行么，简单但代价高，但其实只需要备份还原现场的必要信息即可。



涉及角色：

- 目标（被管理者）：除了基本的成员方法，还要包含如何备份，如何恢复
- 备份类：描述具体要备份的东西，备份时产生一个对象，恢复时用一个对象恢复。
- 管理员：负责管理备份，创建、删除、查询等



多状态如何备份？



多备份如何备份？



# 类图



# 实现

```cpp
#include <iostream>
#include <string>
#include <map>
using namespace std;

class Backup {
private:
    // 多状态
    int _stat1, _stat2;
public:
    Backup() = default;
    Backup(int stat1, int stat2) : _stat1(stat1), _stat2(stat2) {}

    int stat1() const {
        return _stat1;
    }

    int stat2() const {
        return _stat2;
    }
};

class Target {
private:
    int _x, _y;
public:
    Target(int x, int y) : _x(x), _y(y) {}

    Backup backup() const {
        return Backup(_x, _y);
    }

    void recover(const Backup& bp) {
        _x = bp.stat1();
        _y = bp.stat2();
    }

    void output() const {
        cout << "x: " << _x << ", y: " << _y << endl;
    }
};

class Manager {
private:
    // 多备份
    map<string, Backup> _bps;
public:
    void add(const string& key, const Backup& bp) {
        _bps[key] = bp;
    }

    Backup query(const string& key) {
        return _bps[key];
    }
};


int main() {
    Target t(10, 20);
    Manager manager;
    manager.add("01", t.backup());
    t.output();
    t = Target(30, 40);
    t.output();
    t.recover(manager.query("01"));
    t.output();

    return 0;
}
```





# 应用

