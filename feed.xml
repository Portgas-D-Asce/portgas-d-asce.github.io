<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://xdevil.top/feed.xml" rel="self" type="application/atom+xml" /><link href="https://xdevil.top/" rel="alternate" type="text/html" /><updated>2025-08-20T06:48:53+00:00</updated><id>https://xdevil.top/feed.xml</id><title type="html">Devil’s blog</title><subtitle>Technology summarization for personal usage.</subtitle><author><name>Devil</name><email>Devil@gmail.com</email></author><entry><title type="html">CRC32 校验</title><link href="https://xdevil.top/2025/08/18/CRC32-%E6%A0%A1%E9%AA%8C.html" rel="alternate" type="text/html" title="CRC32 校验" /><published>2025-08-18T00:00:00+00:00</published><updated>2025-08-18T00:00:00+00:00</updated><id>https://xdevil.top/2025/08/18/CRC32%20%E6%A0%A1%E9%AA%8C</id><content type="html" xml:base="https://xdevil.top/2025/08/18/CRC32-%E6%A0%A1%E9%AA%8C.html"><![CDATA[<h1 id="概述">概述</h1>

<p>CRC32 算法有多种变体，主要区别在于 <strong>多项式表示方式（Normal vs Reversed/Reflected）</strong> 和 <strong>初始值、输出异或值等参数</strong>。<code class="language-plaintext highlighter-rouge">0x04C11DB7</code> 和 <code class="language-plaintext highlighter-rouge">0xEDB88320</code> 是同一个多项式的两种不同表示形式，分别用于 <strong>正向 CRC-32</strong> 和 <strong>反向 CRC-32</strong>。</p>

<h1 id="正向-crc-320x04c11db7">正向 CRC-32（0x04C11DB7）</h1>

<h2 id="bitwise">bitwise</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<h2 id="look-table">look table</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<h1 id="反向-crc-320xedb88320">反向 CRC-32（0xEDB88320）</h1>

<p>常用在 ZIP/GZIP/PNG 等格式中</p>

<h2 id="bitwise-1">bitwise</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span>
<span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">crc32_bitwise</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">crc</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">crc</span> <span class="o">^=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">crc</span> <span class="o">=</span> <span class="p">(</span><span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="p">((</span><span class="n">crc</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0xEDB88320</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">crc</span> <span class="o">^</span> <span class="mh">0xFFFFFFFF</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">;</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">ptr</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%02X "</span><span class="p">,</span> <span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="k">const</span> <span class="k">auto</span> <span class="n">crc</span> <span class="o">=</span> <span class="n">crc32_bitwise</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"CRC32（十进制）: "</span> <span class="o">&lt;&lt;</span> <span class="n">crc</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"CRC32（十六进制）: "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">hex</span> <span class="o">&lt;&lt;</span> <span class="n">crc</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="look-table-1">look table</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;array&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">CRC32</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">calculate</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">initial</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="p">,</span> <span class="mi">256</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="p">[]()</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="p">,</span> <span class="mi">256</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="p">,</span> <span class="mi">256</span><span class="o">&gt;</span> <span class="n">nums</span><span class="p">{};</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">uint32_t</span> <span class="n">crc</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="n">crc</span> <span class="o">=</span> <span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span> <span class="o">^</span> <span class="p">((</span><span class="n">crc</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0xEDB88320</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
                <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">crc</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">nums</span><span class="p">;</span>
        <span class="p">}();</span>

        <span class="kt">uint32_t</span> <span class="n">crc</span> <span class="o">=</span> <span class="n">initial</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">crc</span> <span class="o">=</span> <span class="p">(</span><span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">^</span> <span class="n">table</span><span class="p">[(</span><span class="n">crc</span> <span class="o">^</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">crc</span> <span class="o">^</span> <span class="mh">0xFFFFFFFF</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">calculate</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span> <span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">initial</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">calculate</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">initial</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="kt">size_t</span> <span class="n">N</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">calculate</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;&amp;</span> <span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">initial</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">calculate</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">N</span><span class="p">,</span> <span class="n">initial</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">;</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="n">ptr</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%02X "</span><span class="p">,</span> <span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="k">const</span> <span class="k">auto</span> <span class="n">crc</span> <span class="o">=</span> <span class="n">CRC32</span><span class="o">::</span><span class="n">calculate</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"CRC32（十进制）: "</span> <span class="o">&lt;&lt;</span> <span class="n">crc</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"CRC32（十六进制）: "</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">hex</span> <span class="o">&lt;&lt;</span> <span class="n">crc</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="理论">理论</h1>

<p>？？？？？</p>

<h1 id="链接">链接</h1>

<p><a href="https://www.lddgo.net/encrypt/crc">CRC 在线计算</a></p>]]></content><author><name>devil</name></author><category term="linux" /><summary type="html"><![CDATA[xxxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/60.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/60.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Kanzi QNX 交叉编译环境搭建</title><link href="https://xdevil.top/2025/08/18/Kanzi-QNX-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" rel="alternate" type="text/html" title="Kanzi QNX 交叉编译环境搭建" /><published>2025-08-18T00:00:00+00:00</published><updated>2025-08-18T00:00:00+00:00</updated><id>https://xdevil.top/2025/08/18/Kanzi%20QNX%20%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA</id><content type="html" xml:base="https://xdevil.top/2025/08/18/Kanzi-QNX-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html"><![CDATA[<h1 id="交叉编译工具">交叉编译工具</h1>

<h2 id="qnx710">QNX710</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /opt/qnx710_3/
total 32
drwxrwxr-x 2 pk pk 4096 Oct 23  2022 bsp
drwxrwxr-x 2 pk pk 4096 Oct 23  2022 docs
drwxrwxr-x 6 pk pk 4096 Oct 23  2022 host
<span class="nt">-rwxrwxr-x</span> 1 pk pk  972 Oct 23  2022 qnxsdp-env.bat
<span class="nt">-rwxrwxr-x</span> 1 pk pk 1676 Oct 23  2022 qnxsdp-env.sh
drwxrwxr-x 2 pk pk 4096 Oct 23  2022 <span class="nb">source
</span>drwxrwxr-x 3 pk pk 4096 Oct 23  2022 target
drwxrwxr-x 3 pk pk 4096 Oct 23  2022 targetImages
</code></pre></div></div>

<h2 id="kanzi-交叉编译链">Kanzi 交叉编译链</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /opt/Kanzi-3.9.0-qnx710_screen_aarch64_cxx-es3-freetype-static_libc++/
total 4
drwxr-xr-x 8 root root 4096 Sep 13  2024 Engine
</code></pre></div></div>

<h1 id="clion">CLion</h1>

<p>本文 IDE 使用 CLion 进行开发环境搭建</p>

<h1 id="toolchains">Toolchains</h1>

<p>Settings -&gt; Build, Execution, Deployment -&gt; Toolchains -&gt; + -&gt; System</p>

<ul>
  <li><strong>Name:</strong> QNX710</li>
  <li><strong>Environment file:</strong> /opt/qnx710_3/qnxsdp-env.sh</li>
  <li><strong>CMake:</strong> Bundled
    <ul>
      <li><strong>Build Tool:</strong> Detected ninja</li>
      <li><strong>C Compiler:</strong> /opt/qnx710_3/host/linux/x86_64/usr/bin/ntoaarch64-gcc</li>
      <li><strong>C++ Compiler:</strong> /opt/qnx710_3/host/linux/x86_64/usr/bin/ntoaarch64-g++</li>
    </ul>
  </li>
  <li><strong>Debugger:</strong> Bundled GDB</li>
</ul>

<p><img src="/assets/content/21.png" alt="21.png" /></p>

<h1 id="cmake-profiles">CMake Profiles</h1>

<p>Settings -&gt; Settings -&gt; Build, Execution, Deployment -&gt; CMake-&gt; +</p>

<ul>
  <li><strong>Name:</strong> Release-QNX710</li>
  <li><strong>Build type:</strong> Release</li>
  <li><strong>Toolchain:</strong> QNX710</li>
  <li><strong>Generator:</strong> Use default Ninja</li>
  <li><strong>CMake options:</strong> -DKANZIDIR=/opt/Kanzi-3.9.0-qnx710_screen_aarch64_cxx-es3-freetype-static_libc++</li>
  <li><strong>Build directory:</strong> build</li>
  <li><strong>Build options:</strong> -j 2</li>
</ul>

<p><img src="/assets/content/20.png" alt="20.png" /></p>

<h1 id="cmakelists">CMakeLists</h1>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.10<span class="p">)</span>

<span class="nb">project</span><span class="p">(</span>www LANGUAGES C CXX<span class="p">)</span>

<span class="nb">set</span><span class="p">(</span>CMAKE_CXX_STANDARD 14<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_CXX_STANDARD_REQUIRED ON<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_CXX_FLAGS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CXX_FLAGS</span><span class="si">}</span><span class="s2"> -std=gnu++14 -stdlib=libc++"</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>CMAKE_INSTALL_PREFIX <span class="si">${</span><span class="nv">CMAKE_SOURCE_DIR</span><span class="si">}</span>/output/<span class="si">${</span><span class="nv">CMAKE_BUILD_TYPE</span><span class="si">}</span><span class="p">)</span>

<span class="nb">add_definitions</span><span class="p">(</span>-DQNX<span class="p">)</span>

<span class="nb">include_directories</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span>/<span class="p">)</span>
<span class="nb">include_directories</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span>/xxx<span class="p">)</span>

<span class="nb">add_subdirectory</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_SOURCE_DIR</span><span class="si">}</span>/xxx/<span class="p">)</span>
</code></pre></div></div>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span> <span class="p">(</span>VERSION 3.10<span class="p">)</span>

<span class="nb">project</span><span class="p">(</span>demo<span class="p">)</span>

<span class="nb">add_definitions</span><span class="p">(</span>
    -DQNX_SCREEN
    -DKANZI_FEATURE_3D
    -DKZ_RUNTIME_GRAPHICS_BACKEND=1
    -DKZ_DLOAD_GL_SYMBOLS=12
    -DKZ_SUPPORT_GRAPHICS_API_OPENGL=1
    -DKZ_SUPPORT_GRAPHICS_API_GLES=1
    -DKZ_SUPPORT_GRAPHICS_CONTEXT_API_WGL=1
    -DKZ_SUPPORT_GRAPHICS_CONTEXT_API_EGL=1
    -DKZ_DLOAD_GLES_SYMBOLS=32
    -DKZ_DLOAD_EGL_SYMBOLS=1
    -D_CRT_SECURE_NO_WARNINGS
    -DKZ_INLINE=inline
    <span class="c1">#-D _GLIBCXX_USE_CXX11_ABI=0</span>
    -DWSEGL
<span class="p">)</span>

<span class="nb">add_subdirectory</span> <span class="p">(</span>kanzi<span class="p">)</span>

<span class="nb">file</span><span class="p">(</span>GLOB_RECURSE sources
        *.cpp
        *.h
<span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> <span class="si">${</span><span class="nv">sources</span><span class="si">}</span><span class="p">)</span>

<span class="nb">target_include_directories</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> PUBLIC
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/include
<span class="p">)</span>

<span class="nb">target_link_directories</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> PUBLIC
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/lib/qnx710_screen_aarch64_cxx/ES3_Release
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/libraries/platforms/qnx710-aarch64-cxx/icu/lib
<span class="p">)</span>

<span class="nb">target_link_libraries</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> PUBLIC
        kzappfw
        kzcore
        kzcoreui
        kzui
        kzfreetypeplugin
        screen
        sicuuc
        sicudata
        kanzi
<span class="p">)</span>

<span class="nb">install</span><span class="p">(</span>TARGETS <span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> RUNTIME DESTINATION apps<span class="p">)</span>
<span class="nb">install</span><span class="p">(</span>FILES
        <span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span>/xxx.kzb
        <span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span>/datasource.json
        <span class="si">${</span><span class="nv">PROJECT_SOURCE_DIR</span><span class="si">}</span>/config.json DESTINATION apps<span class="p">)</span>

</code></pre></div></div>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">project</span><span class="p">(</span>kanzi<span class="p">)</span>

<span class="nb">option</span><span class="p">(</span>KANZIPlugin_BUILD_SHARED_LIBS <span class="s2">"Build using shared libraries"</span> OFF<span class="p">)</span>

<span class="nb">file</span><span class="p">(</span>GLOB sources *.h *.hpp *.cpp<span class="p">)</span>

<span class="nb">add_library</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> STATIC <span class="si">${</span><span class="nv">sources</span><span class="si">}</span><span class="p">)</span>

<span class="nb">target_include_directories</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> PUBLIC
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/libraries/common/boost/include
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/include
<span class="p">)</span>

<span class="nb">target_link_directories</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span> PUBLIC
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/lib/qnx710_screen_aarch64_cxx/ES3_Release
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/libraries/platforms/qnx710-aarch64-cxx/libunibreak/lib
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/libraries/platforms/qnx710-aarch64-cxx/harfbuzz/lib
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/libraries/platforms/qnx710-aarch64-cxx/libpng/lib
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/libraries/platforms/qnx710-aarch64-cxx/libjpeg/lib
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/libraries/platforms/qnx710-aarch64-cxx/freetype/lib
        <span class="si">${</span><span class="nv">KANZIDIR</span><span class="si">}</span>/Engine/libraries/platforms/qnx710-aarch64-cxx/zlib/lib
<span class="p">)</span>

<span class="nb">target_link_libraries</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span>
        slog2
        kzappfw
        kzcore
        kzcoreui
        kzui
        unibreak
        harfbuzz
        png
        jpeg
        freetype
        GLESv2
        EGL
        z
<span class="p">)</span>

</code></pre></div></div>

<h1 id="rundebug-configurations">Run/Debug Configurations</h1>

<p>点击运行时，由于是交叉编译，程序是无法运行起来的，但编译产物还是要生成并进行打包的，以便推送到运行环境中执行</p>

<p>Run/Debug Configurations -&gt; Before launch -&gt; +</p>

<ul>
  <li><strong>install:</strong> 运行前执行 make install 命令拷贝编译产物到输出路径</li>
  <li><strong>CMake Target: package:</strong> 打包命令，将输出路径下编译产物打包为压缩文件</li>
</ul>

<p><img src="/assets/content/19.png" alt="19.png" /></p>

<h1 id="kanzi-stdio">Kanzi Stdio</h1>
<p>替换 dll 和 license</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kanzi.lic</span>

C:<span class="se">\P</span>rogramData<span class="se">\R</span>ightware<span class="se">\K</span>anzi<span class="se">\L</span>icenses_Kanzi3
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># rlm1212.dll</span>

D:<span class="se">\k</span>anzi3_6_15_63<span class="se">\S</span>tudio<span class="se">\B</span><span class="k">in</span>
</code></pre></div></div>]]></content><author><name>devil</name></author><category term="kanzi" /><category term="qnx" /><summary type="html"><![CDATA[xxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/61.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/61.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">内存检查工具</title><link href="https://xdevil.top/2025/08/18/%E5%86%85%E5%AD%98%E6%A3%80%E6%9F%A5%E5%B7%A5%E5%85%B7.html" rel="alternate" type="text/html" title="内存检查工具" /><published>2025-08-18T00:00:00+00:00</published><updated>2025-08-18T00:00:00+00:00</updated><id>https://xdevil.top/2025/08/18/%E5%86%85%E5%AD%98%E6%A3%80%E6%9F%A5%E5%B7%A5%E5%85%B7</id><content type="html" xml:base="https://xdevil.top/2025/08/18/%E5%86%85%E5%AD%98%E6%A3%80%E6%9F%A5%E5%B7%A5%E5%85%B7.html"><![CDATA[<h1 id="valgrind">Valgrind</h1>

<h2 id="apt">apt</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 版本老, 存在 valgrind: the 'impossible' happened: Unsupported arch_prctl option 问题</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>valgrind
</code></pre></div></div>

<h2 id="源码编译">源码编译</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1、下载地址: Current Releases

2、解压: <span class="nb">tar </span>xvf valgrind-3.20.0.tar.bz2

3、执行autogen.sh： <span class="nb">cd </span>valgrind-3.20.0 <span class="o">&amp;&amp;</span> ./autogen.sh

如果出现如下错误：./autogen.sh: line 6: aclocal: <span class="nb">command </span>not found error: <span class="k">while </span>running <span class="s1">'aclocal'</span>
缺少依赖，执行如下命令进行安装即可： <span class="nb">sudo </span>apt <span class="nb">install </span>automake
4、配置: ./configure <span class="nt">--prefix</span><span class="o">=</span>/usr/local/valgrind

5、编译: make <span class="nt">-j8</span>

6、安装: <span class="nb">sudo </span>make <span class="nb">install</span>
</code></pre></div></div>

<h2 id="使用">使用</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<h1 id="sanitizer">Sanitizer</h1>]]></content><author><name>devil</name></author><category term="linux" /><summary type="html"><![CDATA[Valgrind, Sanitizer 等]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/62.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/62.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Linux 常用命令</title><link href="https://xdevil.top/2025/08/17/Linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" rel="alternate" type="text/html" title="Linux 常用命令" /><published>2025-08-17T00:00:00+00:00</published><updated>2025-08-17T00:00:00+00:00</updated><id>https://xdevil.top/2025/08/17/Linux%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4</id><content type="html" xml:base="https://xdevil.top/2025/08/17/Linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html"><![CDATA[<h1 id="cloc">cloc</h1>
<p>代码统计工具</p>
<h2 id="安装">安装</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>cloc
</code></pre></div></div>

<h2 id="使用">使用</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cloc <span class="nb">.</span>
</code></pre></div></div>

<h1 id="压缩命令">压缩命令</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># tar 压缩</span>
<span class="nb">tar</span> <span class="nt">-zcvf</span> xxx.tar.gz dir_xxx

<span class="c"># tar 解压缩</span>
<span class="nb">tar</span> <span class="nt">-zxvf</span> xxx.tar.gz

<span class="c"># rar 压缩</span>
rar a xxx.rar dir_xxx
</code></pre></div></div>]]></content><author><name>pk</name></author><category term="linux" /><summary type="html"><![CDATA[实用工具汇总]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/57.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/57.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">QNX 常用命令</title><link href="https://xdevil.top/2025/08/17/QNX-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" rel="alternate" type="text/html" title="QNX 常用命令" /><published>2025-08-17T00:00:00+00:00</published><updated>2025-08-17T00:00:00+00:00</updated><id>https://xdevil.top/2025/08/17/QNX%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4</id><content type="html" xml:base="https://xdevil.top/2025/08/17/QNX-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html"><![CDATA[<h1 id="pidin">pidin</h1>

<p>查看进程信息</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># pidin | grep hud</span>
16322605   1 nt/bin/hud_ArCyber  10r NANOSLEEP                              
16322605   2 nt/bin/hud_ArCyber  10r CONDVAR     <span class="o">(</span>0x10f9d17e38<span class="o">)</span>             
16322605   3 nt/bin/hud_ArCyber  10r CONDVAR     <span class="o">(</span>0x4f54b5d920<span class="o">)</span>             
16322605   4 nt/bin/hud_ArCyber  10r RECEIVE     4                          
16322605   5 nt/bin/hud_ArCyber  10r CONDVAR     <span class="o">(</span>0x4f54c03d10<span class="o">)</span>             
16322605   6 nt/bin/hud_ArCyber  10r CONDVAR     <span class="o">(</span>0x4f54c03d10<span class="o">)</span>
</code></pre></div></div>

<h1 id="hogs">hogs</h1>

<p>进程号，进程名称，距离上一次采样到现在 cpu 占用多少 ms，多核 cpu 占用率，单核 cpu 占用率，内存占用大小，内存占用率</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># hogs | grep hud</span>
 16322605  /mnt/bin/hud_    92   0%   3%  19592k   0%
 16322605  /mnt/bin/hud_    89   0%   2%  19592k   0%
 16322605  /mnt/bin/hud_    87   0%   2%  19592k   0%
 
<span class="c"># 杀进程</span>
<span class="nb">kill</span> <span class="nt">-9</span> pid

slay <span class="nt">-9</span> process_name
</code></pre></div></div>]]></content><author><name>pk</name></author><category term="qnx" /><summary type="html"><![CDATA[常用命令记录]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/58.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/58.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">车载域控芯片</title><link href="https://xdevil.top/2025/08/17/%E8%BD%A6%E8%BD%BD%E5%9F%9F%E6%8E%A7%E8%8A%AF%E7%89%87.html" rel="alternate" type="text/html" title="车载域控芯片" /><published>2025-08-17T00:00:00+00:00</published><updated>2025-08-17T00:00:00+00:00</updated><id>https://xdevil.top/2025/08/17/%E8%BD%A6%E8%BD%BD%E5%9F%9F%E6%8E%A7%E8%8A%AF%E7%89%87</id><content type="html" xml:base="https://xdevil.top/2025/08/17/%E8%BD%A6%E8%BD%BD%E5%9F%9F%E6%8E%A7%E8%8A%AF%E7%89%87.html"><![CDATA[<h1 id="高通骁龙-sa8155p">高通骁龙 SA8155P</h1>

<h2 id="安卓">安卓</h2>

<h3 id="proccpuinfo">/proc/cpuinfo</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cat /proc/cpuinfo</span>
processor       : 0
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp
CPU implementer : 0x51
CPU architecture: 8
CPU variant     : 0xd
CPU part        : 0x804
CPU revision    : 14

processor       : 1
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp
CPU implementer : 0x51
CPU architecture: 8
CPU variant     : 0xd
CPU part        : 0x804
CPU revision    : 14

processor       : 2
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp
CPU implementer : 0x51
CPU architecture: 8
CPU variant     : 0xd
CPU part        : 0x804
CPU revision    : 14

processor       : 3
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp
CPU implementer : 0x51
CPU architecture: 8
CPU variant     : 0xd
CPU part        : 0x804
CPU revision    : 14

processor       : 4
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp
CPU implementer : 0x51
CPU architecture: 8
CPU variant     : 0xd
CPU part        : 0x804
CPU revision    : 14

processor       : 5
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp
CPU implementer : 0x51
CPU architecture: 8
CPU variant     : 0xd
CPU part        : 0x804
CPU revision    : 14

processor       : 6
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp
CPU implementer : 0x51
CPU architecture: 8
CPU variant     : 0xd
CPU part        : 0x804
CPU revision    : 14

processor       : 7
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp
CPU implementer : 0x51
CPU architecture: 8
CPU variant     : 0xd
CPU part        : 0x804
CPU revision    : 14
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">CPU architecture: 8</code> → ARMv8</p>

<p><code class="language-plaintext highlighter-rouge">CPU architecture: 9</code> → ARMv9</p>

<p><code class="language-plaintext highlighter-rouge">CPU implementer</code>：厂商（如 <code class="language-plaintext highlighter-rouge">0x51</code>=高通 Qualcomm， qcom）</p>

<p><code class="language-plaintext highlighter-rouge">CPU part</code>：核心型号（如 <code class="language-plaintext highlighter-rouge">0x804</code>=Kryo 485）。</p>

<h3 id="getprop">getprop</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># getprop ro.product.cpu.abi</span>
arm64-v8a

<span class="c"># getprop | grep -i board</span>
<span class="o">[</span>ro.board.platform]: <span class="o">[</span>msmnile]
<span class="o">[</span>ro.product.board]: <span class="o">[</span>msmnile]

<span class="c"># getprop | grep -i platform</span>
<span class="o">[</span>persist.debug.dalvik.vm.core_platform_api_policy]: <span class="o">[</span>just-warn]
<span class="o">[</span>platform_bsp.usb.prim.mode]: <span class="o">[</span>host]
<span class="o">[</span>platform_bsp.usb.receptacle_a.power]: <span class="o">[</span><span class="nb">enable</span><span class="o">]</span>
<span class="o">[</span>platform_bsp.usb.receptacle_a.usbhub_reset]: <span class="o">[</span>high]
<span class="o">[</span>platform_bsp.usb.sec.mode]: <span class="o">[</span>host]
<span class="o">[</span>ro.board.platform]: <span class="o">[</span>msmnile]

<span class="c"># getprop | grep -i soc</span>
<span class="o">[</span>persist.vendor.qcom.bluetooth.soc]: <span class="o">[</span>rome]
<span class="o">[</span>vendor.qcom.bluetooth.soc]: <span class="o">[</span>rome]
</code></pre></div></div>

<p>msmnile: 可以确定您的设备搭载的是 <strong>Qualcomm Snapdragon 8 系列旗舰芯片</strong>，具体属于 <strong>骁龙（Snapdragon） 855（SM8150）或 865（SM8250）平台</strong></p>

<h2 id="qnx">QNX</h2>

<h3 id="pidin">pidin</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># pidin info</span>
CPU:AARCH64 Release:7.0.X  FreeMem:343MB/11GB BootTime:Jan 01 00:00:01 GMT 1970
 Actual resident free memory:369Mb
Processes: 117, Threads: 1153
Processor1: 1373601886 Kryo v4 Silver 1612MHz FPU
Processor2: 1373601886 Kryo v4 Silver 1612MHz FPU
Processor3: 1373601886 Kryo v4 Silver 1612MHz FPU
Processor4: 1373601886 Kryo v4 Silver 1612MHz FPU
Processor5: 1373601870 Kryo v4 Gold 2131MHz FPU
Processor6: 1373601870 Kryo v4 Gold 2131MHz FPU
Processor7: 1373601870 Kryo v4 Gold 2131MHz FPU
Processor8: 1373601870 Kryo v4 Gold Plus 2419MHz FPU

pidin syspage | <span class="nb">grep </span>TAGID
  <span class="o">[</span>779]<span class="s1">'TAGID=QXA.QA.5.0.c5.3-00139-SA8155P.HYP-1'</span> <span class="o">[</span>821]<span class="s1">'STATE=Stable'</span>
</code></pre></div></div>

<h3 id="getprop-1">getprop</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># getprop</span>
<span class="o">[</span>ro.serialno]: <span class="o">[</span>unknown]
<span class="o">[</span>ro.product.name]: <span class="o">[</span>QNX]
<span class="o">[</span>ro.product.model]: <span class="o">[</span>unknown]
<span class="o">[</span>ro.product.board]: <span class="o">[</span>SA8155_ADP_Star_v1.0.0_UFS_NORMAL]
<span class="o">[</span>ro.product.brand]: <span class="o">[</span>unknown]
<span class="o">[</span>ro.product.device]: <span class="o">[</span>unknown]
<span class="o">[</span>ro.product.manufacturer]: <span class="o">[</span>unknown]
<span class="o">[</span>ro.product.cpu.abi]: <span class="o">[</span>aarch64le]
<span class="o">[</span>ro.build.au_rev]: <span class="o">[</span>unknown]
<span class="o">[</span>ro.build.description]: <span class="o">[</span>2023/02/17-13:05:50EST]
<span class="o">[</span>ro.build.version.sdk]: <span class="o">[</span>7.0.X]
</code></pre></div></div>

<h1 id="高通骁龙-sa8295p">高通骁龙 SA8295P</h1>

<h2 id="安卓-1">安卓</h2>

<h3 id="proccpuinfo-1">/proc/cpuinfo</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cat /proc/cpuinfo</span>
processor       : 0
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp uscat ilrcpc flagm
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd4c
CPU revision    : 0

processor       : 1
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp uscat ilrcpc flagm
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd4c
CPU revision    : 0

processor       : 2
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp uscat ilrcpc flagm
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd4c
CPU revision    : 0

processor       : 3
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp uscat ilrcpc flagm
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd4c
CPU revision    : 0

processor       : 4
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp uscat ilrcpc flagm
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd4b
CPU revision    : 0

processor       : 5
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp uscat ilrcpc flagm
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd4b
CPU revision    : 0

processor       : 6
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp uscat ilrcpc flagm
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd4b
CPU revision    : 0

processor       : 7
BogoMIPS        : 38.40
Features        : fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp uscat ilrcpc flagm
CPU implementer : 0x41
CPU architecture: 8
CPU variant     : 0x0
CPU part        : 0xd4b
CPU revision    : 0
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">CPU architecture: 8</code> → ARMv8</p>

<p><code class="language-plaintext highlighter-rouge">CPU architecture: 9</code> → ARMv9</p>

<h3 id="getprop-2">getprop</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># getprop ro.product.cpu.abi</span>
arm64-v8a
andes:/ <span class="c"># getprop | grep -i board</span>
<span class="o">[</span>init.svc.board_info_hw_sh]: <span class="o">[</span>stopped]
<span class="o">[</span>init.svc_debug_pid.board_info_hw_sh]: <span class="o">[]</span>
<span class="o">[</span>ro.board.platform]: <span class="o">[</span>msmnile]
<span class="o">[</span>ro.boottime.board_info_hw_sh]: <span class="o">[</span>19290379002]
<span class="o">[</span>ro.product.board]: <span class="o">[</span>msmnile]
andes:/ <span class="c"># getprop | grep -i platform</span>
<span class="o">[</span>persist.debug.dalvik.vm.core_platform_api_policy]: <span class="o">[</span>just-warn]
<span class="o">[</span>ro.android.car.version.platform_minor]: <span class="o">[</span>3]
<span class="o">[</span>ro.board.platform]: <span class="o">[</span>msmnile]
andes:/ <span class="c"># getprop | grep -i soc</span>
<span class="o">[</span>persist.vendor.qcom.bluetooth.soc]: <span class="o">[</span>rome]
<span class="o">[</span>persist.vendor.qcom.bluetooth.soc1]: <span class="o">[</span>rome]
<span class="o">[</span>ro.boot.boot_devices]: <span class="o">[</span>vdevs/1c140000.virtio_blk.vdevs/1c0b0000.virtio_blk.vdevs/1c0f0000.virtio_blk.vdevs/1c160000.virtio_blk.vdevs/1c130000.virtio_blk.vdevs/1c0e0000.virtio_blk.vdevs/1c100000.virtio_blk.vdevs/1c170000.virtio_blk.vdevs/1c180000.virtio_blk.vdevs/1c110000.virtio_blk.vdevs/1c120000.virtio_blk.vdevs/1c210000.virtio_blk.vdevs/1c220000.virtio_blk.vdevs/1c230000.virtio_blk.vdevs/1c240000.virtio_blk.vdevs/1c250000.virtio_blk.vdevs/1c260000.virtio_blk.vdevs/1c280000.virtio_blk.vdevs/1c290000.virtio_blk.vdevs/1c310000.virtio_blk.vdevs/1c320000.virtio_blk.vdevs/1c410000.virtio_blk.soc/1da4000.ufshc]
<span class="o">[</span>ro.soc.manufacturer]: <span class="o">[</span>Qualcomm]
<span class="o">[</span>ro.soc.model]: <span class="o">[</span>SA8295P]
<span class="o">[</span>ro.vendor.qti.soc_model]: <span class="o">[</span>SA8295P]
<span class="o">[</span>vendor.qcom.bluetooth.soc]: <span class="o">[</span>rome]
</code></pre></div></div>

<h2 id="qnx-1">QNX</h2>

<h3 id="pidin-1">pidin</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># pidin info</span>
CPU:AARCH64 Release:7.1.0  FreeMem:1982MB/23GB BootTime:Jan 01 08:00:01  1970
 Actual resident free memory:1976Mb
Processes: 204, Threads: 1761
Processor1: 1091556528 Octa Kryo-695 Gold 2092MHz FPU
Processor2: 1091556528 Octa Kryo-695 Gold 2092MHz FPU
Processor3: 1091556528 Octa Kryo-695 Gold 2092MHz FPU
Processor4: 1091556528 Octa Kryo-695 Gold 2092MHz FPU
Processor5: 1091556544 Octa Kryo-695 Gold Plus 2380MHz FPU
Processor6: 1091556544 Octa Kryo-695 Gold Plus 2380MHz FPU
Processor7: 1091556544 Octa Kryo-695 Gold Plus 2380MHz FPU
Processor8: 1091556544 Octa Kryo-695 Gold Plus 2380MHz FPU

pidin syspage | <span class="nb">grep </span>TAGID
  <span class="o">[</span>979]<span class="s1">'TAGID=QXA.QA.6.1.r1-00129-GEN4.HYP-1'</span> <span class="o">[</span>1016]<span class="s1">'STATE=Stable'</span>
</code></pre></div></div>]]></content><author><name>pk</name></author><category term="qnx" /><summary type="html"><![CDATA[8155、8295等]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/59.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/59.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Don’t open it</title><link href="https://xdevil.top/%E6%B4%BB%E7%9D%80/2025/08/15/Dont-open-it.html" rel="alternate" type="text/html" title="Don’t open it" /><published>2025-08-15T00:00:00+00:00</published><updated>2025-08-15T00:00:00+00:00</updated><id>https://xdevil.top/%E6%B4%BB%E7%9D%80/2025/08/15/Dont%20open%20it</id><content type="html" xml:base="https://xdevil.top/%E6%B4%BB%E7%9D%80/2025/08/15/Dont-open-it.html"><![CDATA[<p>这世界对我很失望，正如我对着世界一样！</p>

<p>人生就像一场戏，有些人入戏太深！</p>

<p>世界的本质就是一帮草台班子，除了老子，谁也不认！</p>]]></content><author><name>pk</name></author><category term="活着" /><summary type="html"><![CDATA[那些无法说出口，说出来又无人能懂的话]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/55.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/55.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">中二患者</title><link href="https://xdevil.top/%E5%8A%A8%E6%BC%AB/2025/08/15/%E4%B8%AD%E4%BA%8C%E6%82%A3%E8%80%85.html" rel="alternate" type="text/html" title="中二患者" /><published>2025-08-15T00:00:00+00:00</published><updated>2025-08-15T00:00:00+00:00</updated><id>https://xdevil.top/%E5%8A%A8%E6%BC%AB/2025/08/15/%E4%B8%AD%E4%BA%8C%E6%82%A3%E8%80%85</id><content type="html" xml:base="https://xdevil.top/%E5%8A%A8%E6%BC%AB/2025/08/15/%E4%B8%AD%E4%BA%8C%E6%82%A3%E8%80%85.html"><![CDATA[<h1 id="日漫">日漫</h1>
<p>火影忍者</p>

<p>死神</p>

<p>进击的巨人</p>

<p>海贼王</p>

<p>东京喰种</p>

<p>罪恶皇冠</p>

<p>鲁鲁修</p>

<p>灌篮高手</p>

<p>妖精的尾巴</p>

<p>鬼灭之刃</p>

<p>犬夜叉</p>

<h1 id="国漫">国漫</h1>

<p>魁拔</p>

<p>灵笼</p>

<p>仙逆</p>

<p>完美世界</p>

<p>紫川</p>

<p>第九特区</p>

<p>眷思量</p>]]></content><author><name>pk</name></author><category term="动漫" /><summary type="html"><![CDATA[那些年，没追过女孩，只看过番]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/56.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/56.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">变参函数</title><link href="https://xdevil.top/%E8%AE%A1%E7%AE%97%E6%9C%BA/cpp/2025/05/17/%E5%8F%98%E5%8F%82%E5%87%BD%E6%95%B0.html" rel="alternate" type="text/html" title="变参函数" /><published>2025-05-17T00:00:00+00:00</published><updated>2025-05-17T00:00:00+00:00</updated><id>https://xdevil.top/%E8%AE%A1%E7%AE%97%E6%9C%BA/cpp/2025/05/17/%E5%8F%98%E5%8F%82%E5%87%BD%E6%95%B0</id><content type="html" xml:base="https://xdevil.top/%E8%AE%A1%E7%AE%97%E6%9C%BA/cpp/2025/05/17/%E5%8F%98%E5%8F%82%E5%87%BD%E6%95%B0.html"><![CDATA[<h1 id="初识变参函数">初识变参函数</h1>
<p>变参函数基本内容：</p>
<ul>
  <li>就是那个参数列表中有 … （即，<strong>变参列表</strong>）的函数；</li>
  <li>变参函数的 <strong>参数个数</strong> 和 <strong>参数类型</strong> 都是不固定的，但它必须包含一个 <strong>固定参数</strong>；</li>
</ul>

<p>以下为一个变参函数原型示例：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">super_add</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="p">...</span> <span class="p">);</span>
</code></pre></div></div>

<h1 id="简单变参函数实现">简单变参函数实现</h1>

<p>以下为 n 个 int 类型数字求和的变参函数实现（大概看看长什么样子就够了）：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//需要包含头文件 &lt;stdarg.h&gt;</span>
<span class="c1">//这里 n 充当的就是上面所提到的 固定参数</span>
<span class="kt">int</span> <span class="nf">super_add</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">va_list</span> <span class="n">ap</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">va_arg</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">ap</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ps：printf 和 scanf 函数毫无疑问是变参函数的代表作品，有兴趣可以详细了解。</p>

<h2 id="va-一族">va 一族</h2>
<p>上面实现中包含好几个以 va_ 开头的东西（通常被叫做 <strong>va 一族</strong>），下面对它们进行简单介绍：</p>
<ul>
  <li><strong>va_list:</strong> 用它来 声明一个 “变参指针”，我们可以通过该指针来获取变参列表中的内容；</li>
  <li><strong>va_start:</strong> 用于初始化 变参指针，使其指向变参列表中第一个变量；第一个参数为 变参指针，第二个参数为 固定参数；</li>
  <li><strong>va_arg:</strong> 用于获取 变参指针 当前所指的变量，并将 变参指针 指向下一个参数；第一个参数为 变参指针，第二个参数为 当前变参指针所指向变量的类型；</li>
  <li><strong>va_end:</strong> 用于结束变参列表的读取；</li>
</ul>

<h2 id="变参列表以外的参数">变参列表以外的参数</h2>

<p>要想正确的读取到变参列表里面的变量，变参列表以外的变量（包括固定参数）需要完成以下两个任务：</p>
<ul>
  <li><strong>暗示变参列表中参数的个数</strong>: 明确变参列表中有多少个参数</li>
  <li><strong>暗示变参列表中每个参数的类型</strong>: 明确怎么读取变参列表中每个参数</li>
  <li>scanf 和 printf 函数有明确以上两点么？</li>
</ul>

<h2 id="好奇心害死猫">好奇心害死猫</h2>
<p>变参函数究竟是怎么实现的?</p>

<p><strong>/usr/lib/gcc/x86_64-linux-gnu/9/include</strong> 路径下的 <strong>stdarg.h</strong> 中找到了 va 一族的相关内容：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Define the standard macros for the user,
   if this invocation was from the user program.  */</span>
<span class="cp">#ifdef _STDARG_H
</span>
<span class="cp">#define va_start(v,l)	__builtin_va_start(v,l)
#define va_end(v)	__builtin_va_end(v)
#define va_arg(v,l)	__builtin_va_arg(v,l)
</span></code></pre></div></div>

<p>奥，原来它们都是宏啊。这里显然一点有用的信息都没有，继续追踪 <strong>__builtin_va_start(v,l)</strong> 这些东西，然而找不到。</p>

<h1 id="实践出真知">实践出真知</h1>

<h2 id="一些背景">一些背景</h2>

<blockquote>
  <p>从i386到X86架构，函数调用约定发生了天翻地覆的变化：X86不再完全依赖栈进行传递参数，而是通过寄存器传参数，这给运运行库实现va_list、va_start、va_arg和va_end接口带来更大挑战。</p>
</blockquote>

<blockquote>
  <p>X86有6个寄存器传递参数，每个寄存器位宽是8字节;</p>
</blockquote>

<blockquote>
  <p>gcc是采用讨巧的办法，6个寄存器，传递可变参数的那些寄存器，全部压到称为参数保存区的栈空间上;</p>
</blockquote>

<h2 id="实验代码">实验代码</h2>
<p>先不着急看它是干嘛的，就放这，后面再仔细分析。</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdarg.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">sum</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"&amp;n = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>

    <span class="kt">va_list</span> <span class="n">ap</span><span class="p">;</span>
    <span class="n">va_start</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">"sizeof(ap) = %ld, &amp;ap = %p</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ap</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">ap</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"&amp;gp = %p, &amp;fp = %p, &amp;overflow = %p, &amp;reg = %p</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ap</span><span class="o">-&gt;</span><span class="n">gp_offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ap</span><span class="o">-&gt;</span><span class="n">fp_offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ap</span><span class="o">-&gt;</span><span class="n">overflow_arg_area</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ap</span><span class="o">-&gt;</span><span class="n">reg_save_area</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"gp = %d, fp = %d, overflow = %p, reg = %p, "</span><span class="p">,</span> <span class="n">ap</span><span class="o">-&gt;</span><span class="n">gp_offset</span><span class="p">,</span> <span class="n">ap</span><span class="o">-&gt;</span><span class="n">fp_offset</span><span class="p">,</span> <span class="n">ap</span><span class="o">-&gt;</span><span class="n">overflow_arg_area</span><span class="p">,</span> <span class="n">ap</span><span class="o">-&gt;</span><span class="n">reg_save_area</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">va_arg</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"x = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
	    <span class="n">res</span> <span class="o">+=</span> <span class="n">x</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">va_end</span><span class="p">(</span><span class="n">ap</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"sum(1...8) = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//输出</span>
<span class="o">&amp;</span><span class="n">n</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e3fc</span>
<span class="k">sizeof</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ap</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e410</span>

<span class="o">&amp;</span><span class="n">gp</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e410</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fp</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e414</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e418</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e420</span>

<span class="n">gp</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e4f0</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e4f0</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e4f0</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e4f0</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e4f0</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e4f0</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e4f8</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e500</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e508</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e510</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e518</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">gp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span> <span class="n">overflow</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e520</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7ffcfd09e430</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">...</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="mi">78</span>
</code></pre></div></div>

<h2 id="va_list">va_list</h2>

<p>理解 va_list 是个什么东西？</p>

<p>终端执行以下命令，编译上面源码，并用 gdb 查看 va_list：</p>
<ul>
  <li>gcc -g main.c</li>
  <li>gdb ./a.out</li>
  <li>ptype va_list</li>
</ul>

<p>得到以下内容：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">type</span> <span class="o">=</span> <span class="k">struct</span> <span class="n">__va_list_tag</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gp_offset</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fp_offset</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">overflow_arg_area</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">reg_save_area</span><span class="p">;</span>
<span class="p">}</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>
<p>成员含义：</p>
<ul>
  <li>gp_offset：通用寄存器偏移量，是指下个va_arg(ap, xxx)调用要获取的参数，在参数保存区的offset；</li>
  <li>fp_offset：浮点寄存器偏移量；</li>
  <li>overflow_arg_area：其它参数保存区，是个指针，指向栈传递的参数区；</li>
  <li>reg_save_area：寄存器保存区，是个指针，指向prologue指令建好的参数保存区；</li>
</ul>

<p>对比代码输出，有规律：</p>
<ul>
  <li>总体上，先取寄存器里面的变量，后取参数保存区里的变量</li>
  <li>取第几个寄存器中的变量由 寄存器基地址 + 寄存器偏移量决定</li>
  <li>取参数保存区哪个变量由 overflow 指针决定</li>
</ul>

<!--此处应该有一张图-->

<h2 id="其它">其它</h2>

<p>为变参列表中每个变量所申请的内存空间都是 8 字节，无论实际传进去的是 char / int / long；</p>

<p>参数保存区的到小固定，为 6 * 8 = 48 字节；</p>

<h1 id="参考">参考</h1>
<p><a href="https://zhuanlan.zhihu.com/p/94036267">揭秘X86架构C可变参数函数实现原理</a></p>]]></content><author><name>pk</name></author><category term="计算机" /><category term="cpp" /><summary type="html"><![CDATA[xxxxxxxxxxxxxxxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/54.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/54.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">马拉车算法（Longest Palindromic Substring）</title><link href="https://xdevil.top/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/2025/04/10/%E9%A9%AC%E6%8B%89%E8%BD%A6%E7%AE%97%E6%B3%95-Longest-Palindromic-Substring.html" rel="alternate" type="text/html" title="马拉车算法（Longest Palindromic Substring）" /><published>2025-04-10T00:00:00+00:00</published><updated>2025-04-10T00:00:00+00:00</updated><id>https://xdevil.top/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/2025/04/10/%E9%A9%AC%E6%8B%89%E8%BD%A6%E7%AE%97%E6%B3%95%EF%BC%88Longest%20Palindromic%20Substring%EF%BC%89</id><content type="html" xml:base="https://xdevil.top/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/2025/04/10/%E9%A9%AC%E6%8B%89%E8%BD%A6%E7%AE%97%E6%B3%95-Longest-Palindromic-Substring.html"><![CDATA[<h1 id="brute-force">Brute Force</h1>

<p>可以先找到所有子串，然后判断每个子串是否为回文，期间记录最长回文子串即可：</p>
<ul>
  <li>一个长度为 $n$ 的字符串的子串的个数为： $n(n + 1) / 2$ ；</li>
  <li>判断字符串是否为回文时间复杂度为 $O(n)$;</li>
</ul>

<p>因此，总的时间复杂度为 $O(n^3)$ 。</p>

<h1 id="better-than-brute-force">Better Than Brute Force</h1>

<p>以第 $i$ 个字符为中心，向两边扩展（奇数、偶数都扩展一次），即可得到：</p>

<ul>
  <li>以第 $i$ 个字符为中心的最长回文（时间复杂度为 $O(n)$）</li>
  <li>对每个字符进行同样的操作，总共需执行 $n$ 次</li>
  <li>期间记录下最长回文即可。</li>
</ul>

<p>显然，总的时间复杂度为 $O(n^2)$ 。</p>

<h1 id="马拉车算法">马拉车算法</h1>

<h2 id="算法步骤">算法步骤</h2>

<p>可分为三步：</p>
<ul>
  <li>对原字符串 $s$ 预处理，得到预处理字符串 $t$ ，<strong>使回文子串长度只能是奇数</strong>，简化后续处理</li>
  <li>计算 $t$ 的最长回文子串</li>
  <li>还原出 $s$ 的最长回文子串</li>
</ul>

<h2 id="预处理">预处理</h2>

<p>在 <strong>Better Than Brute Force</strong> 方案中我们需要考虑回文子串长度为奇数（eg，bcb）、偶数（eg，bccb）的两种情况</p>

<p>马拉车的预处理方法：在每个字符左右两侧都加上特殊字符，巧妙地避开了这个问题：</p>
<ul>
  <li>原字符串：”acbcd”;</li>
  <li>预处理后字符串：”#a#c#b#c#d#”;</li>
</ul>

<p>通过这样的预处理，使得回文子串长度只能为奇数，完全不必讨论偶数情况。</p>

<p>额外加一个特殊字符</p>

<ul>
  <li>可以预防左边界越界 “#a#c#b#c#a#”（整个串都是回文） 变为 “##a#c#b#c#a#”</li>
  <li>为什么右边界不用预防？看不起 ‘\0’ ？</li>
</ul>

<h2 id="预处理后字符串-t-的最长回文子串">预处理后字符串 t 的最长回文子串</h2>

<h3 id="变量说明">变量说明</h3>

<p>首先需要理解两个重要而又晦涩难懂的辅助变量：</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">mx</code>：当前已找到的回文子串能延伸到的最右端位置的 <strong>下一个位置</strong></li>
  <li><code class="language-plaintext highlighter-rouge">id</code>：延伸到最右端的位置的回文子串的中心点位置（预处理字符串回文子串长度必为奇数，所以一定有中心点位置）</li>
</ul>

<p>其它一些变量及其含义：</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">p[id]</code>：以索引 <code class="language-plaintext highlighter-rouge">id</code> 为中心的最长回文子串的半径（包括中心点）；</li>
  <li><code class="language-plaintext highlighter-rouge">i</code>：当前访问字符的索引；</li>
  <li><code class="language-plaintext highlighter-rouge">j</code>：<code class="language-plaintext highlighter-rouge">i</code> 关于 <code class="language-plaintext highlighter-rouge">id</code> 的对称位置（即，<code class="language-plaintext highlighter-rouge">j = 2 * id - i</code>）；</li>
</ul>

<h3 id="核心代码">核心代码</h3>

<p>马拉车算法中最核心的一行代码</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">?</span> <span class="n">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">id</span> <span class="o">-</span> <span class="n">i</span><span class="p">],</span> <span class="n">mx</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<p>当 $mx &lt;= i$ 时：$i$ 处于 $mx$ 右端，没有可用信息，只能确定以 $i$ 为中心的最长回文子串的半径至少为1</p>

<p>当 $mx &gt; i$ 时：$i$ 在 $mx$ 延伸范围内，存在可用信息：</p>

<ul>
  <li>当 $mx - i &gt;= p[j]$ 时，根据对称，以 $j$ 为中心的最长回文子串 和 以 $i$ 为中心的最长回文子串都被包含在以 $id$ 为中心的最长回文子串内，如下图所示：</li>
</ul>

<p><img src="/assets/content/17.png" alt="/assets/content/17.png" /></p>

<ul>
  <li>当 $mx - i &lt; p[j]$ 时，根据对称，我们可以确定以$i$ 为中心的最长回文子串的半径至少为 $mx - i$，到底是多少还要继续进行比较，如下图所示：</li>
</ul>

<p><img src="/assets/content/18.png" alt="/assets/content/18.png" /></p>

<h2 id="原字符串-s-的最长回文子串">原字符串 s 的最长回文子串</h2>

<h3 id="长度计算">长度计算</h3>

<p>先观察以下两种情况：</p>
<ul>
  <li>$t$ 的最长回文子串 “#b#c#b#” 长度为 7，半径为 4，其所对应的 $s$ 的最长回文子串 “bcb” 长度为 3</li>
  <li>$t$ 的最长回文子串 “#b#c#c#b#”  长度为 9，半径为 5，其所对应的 $s$ 的最长回文子串 “bccb” 长度为 4</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">s 最长回文子串长度 = t 最长回文子串半径长度 - 1</code></p>

<h3 id="起始索引计算">起始索引计算</h3>

<p>知道了 $s$ 最长回文子串的长度，只要再知道其在原字符串中的起始索引，就可以截取到最长回文子串。示例：</p>

<p>$s$ = “cambcbdn” （最长回文子串为奇数情况）：</p>
<ul>
  <li>预处理后：$t$ = “##c#a#m#b#c#b#d#n#”</li>
  <li>$t$ 最长回文子串：#b#c#b#，半径为4，其中心字符 ‘c’ 的索引为10</li>
  <li>$s$ 最长回文子串：bcb，起始索引为 (10 - 4) / 2 = 3</li>
</ul>

<p>$s$ = “ambccbdn”（最长回文子串为偶数情况）：</p>
<ul>
  <li>预处理后为：$t$ = “##a#m#b#c#c#b#d#n#”</li>
  <li>$t$ 最长回文子串：#b#c#c#b#，半径为5，其中心字符为’#’索引为9</li>
  <li>$s$ 最长回文子串：bccb，起始索引为 (9 - 5) / 2 = 2</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">s 最长回文子串起始索引 =（t 最长回文子串中心字符索引 - t 最长回文子串半径）/ 2</code></p>

<h2 id="代码实现">代码实现</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span>

<span class="n">string</span> <span class="nf">process</span><span class="p">(</span><span class="n">string</span> <span class="n">s</span><span class="p">){</span>
    <span class="n">string</span> <span class="n">res</span> <span class="o">=</span> <span class="s">"##"</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">res</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">res</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="sc">'#'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">string</span> <span class="nf">manacher</span><span class="p">(</span><span class="n">string</span> <span class="n">s</span><span class="p">){</span>
    <span class="n">string</span> <span class="n">t</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// 无法从 0 开始，p[i] 至少为 1，从 0 开始 i - p[i] = -1</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 延伸内部存在可用信息</span>
        <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">?</span> <span class="n">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">id</span> <span class="o">-</span> <span class="n">i</span><span class="p">],</span> <span class="n">mx</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        
        <span class="c1">// 延伸外部不存在可用信息，需逐一比较</span>
        <span class="k">while</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="p">{</span>
            <span class="o">++</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        
        <span class="c1">// 更新延伸</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mx</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">mx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">id</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// 记录 t 最长回文子串的半径及中心</span>
        <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// 还原得到 s 的最长回文子串</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">substr</span><span class="p">((</span><span class="n">c</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="时间复杂度">时间复杂度</h2>

<p>时间复杂度：$O(n)$</p>

<p>空间复杂度：$O(n)$</p>

<h1 id="封装">封装</h1>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">manacher</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="n">U</span> <span class="n">start</span><span class="p">,</span> <span class="n">U</span> <span class="n">end</span><span class="p">){</span>
    <span class="k">using</span> <span class="n">U</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">type_traits</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value_type</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    
    <span class="n">T</span> <span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">start</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">ch</span> <span class="o">:</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">t</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
        <span class="n">t</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">start</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">t</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">end</span><span class="p">);</span>
    
    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 延伸内部存在可用信息</span>
        <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">?</span> <span class="n">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">id</span> <span class="o">-</span> <span class="n">i</span><span class="p">],</span> <span class="n">mx</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        
        <span class="c1">// 延伸外部不存在可用信息，需逐一比较</span>
        <span class="k">while</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="p">{</span>
            <span class="o">++</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        
        <span class="c1">// 更新延伸</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mx</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">mx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">id</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// 记录 t 最长回文子串的半径及中心</span>
        <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// 还原得到 s 的最长回文子串, 起始位置 + 长度</span>
    <span class="k">return</span> <span class="p">{(</span><span class="n">c</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="练习题">练习题</h1>

<p><a href="https://leetcode.com/problems/longest-palindromic-substring/">LeetCode 5. Longest Palindromic Substring</a>
<a href="https://leetcode.com/problems/palindromic-substrings/">LeetCode 647. Palindromic Substrings</a></p>

<p><a href="https://codeforces.com/contest/1943/problem/B">B. Non-Palindromic Substring</a></p>]]></content><author><name>pk</name></author><category term="计算机" /><category term="数据结构与算法" /><category term="字符串" /><summary type="html"><![CDATA[xxxxxxxxxxxxxxxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/53.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/53.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>