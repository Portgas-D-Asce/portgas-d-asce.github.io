<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://xdevil.top/feed.xml" rel="self" type="application/atom+xml" /><link href="https://xdevil.top/" rel="alternate" type="text/html" /><updated>2026-03-01T14:28:43+00:00</updated><id>https://xdevil.top/feed.xml</id><title type="html">Devilâ€™s blog</title><subtitle>Technology summarization for personal usage.</subtitle><author><name>Devil</name><email>Devil@gmail.com</email></author><entry><title type="html">å°‘è¯´è¯ï¼Œå¤šè¯»ä¹¦</title><link href="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/02/28/%E5%B0%91%E8%AF%B4%E8%AF%9D-%E5%A4%9A%E8%AF%BB%E4%B9%A6.html" rel="alternate" type="text/html" title="å°‘è¯´è¯ï¼Œå¤šè¯»ä¹¦" /><published>2026-02-28T00:00:00+00:00</published><updated>2026-02-28T00:00:00+00:00</updated><id>https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/02/28/%E5%B0%91%E8%AF%B4%E8%AF%9D%EF%BC%8C%E5%A4%9A%E8%AF%BB%E4%B9%A6</id><content type="html" xml:base="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/02/28/%E5%B0%91%E8%AF%B4%E8%AF%9D-%E5%A4%9A%E8%AF%BB%E4%B9%A6.html"><![CDATA[<h1 id="å¹³å‡¡çš„ä¸–ç•Œ">å¹³å‡¡çš„ä¸–ç•Œ</h1>

<h1 id="æ´»ç€">æ´»ç€</h1>

<h1 id="å›´åŸ">å›´åŸ</h1>]]></content><author><name>Devil</name></author><category term="æ´»ç€" /><summary type="html"><![CDATA[æ¯”è¾ƒæ‡’ï¼Œåº”è¯¥æ˜¯å¤šå¬ä¹¦ï¼Œå“ˆå“ˆ]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/78.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/78.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Who is a little boy, this is an old man</title><link href="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/26/Who-is-a-little-boy,-this-is-an-old-man.html" rel="alternate" type="text/html" title="Who is a little boy, this is an old man" /><published>2026-01-26T00:00:00+00:00</published><updated>2026-01-26T00:00:00+00:00</updated><id>https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/26/Who%20is%20a%20little%20boy,%20this%20is%20an%20old%20man</id><content type="html" xml:base="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/26/Who-is-a-little-boy,-this-is-an-old-man.html"><![CDATA[<p>ä¸Šå¹¼å„¿ç­æŠ¥é“çš„æ—¶å€™ï¼Œè€å¸ˆè¯´ï¼Œçœ‹ç€å¥½å°å•Šï¼Œæ˜å¹´å†æ¥å§ï¼Œçœå¾—åœ¨å­¦æ ¡é‡Œå—æ¬ºè´Ÿ</p>

<p>ä¸Šå¤§å­¦çš„æ—¶å€™ï¼Œå­¦å§è¯´çœ‹ç€å¥½å°å•Š</p>

<p>çº¿ä¸‹é¢åŸºï¼Œä½ çœ‹ç€æŒºå°çš„</p>

<p>æœ‹å‹å©šç¤¼ä¸Šï¼Œçœ‹ç€ä½ å¥½å°å•Šï¼Œä¸€å¼€å§‹è¿˜ä»¥ä¸ºä½ æ˜¯è°çš„å¼Ÿå¼Ÿå‘¢</p>

<p>å…¬å¸åŒäº‹ï¼Œä½ çœ‹ç€å¥½å° â€¦â€¦</p>

<p>éƒ½è¯´è°å‘¢ï¼Ÿè€å¤«å·²ç»å¥”å››å¥½ä¹…äº†ï¼Œé©¬ä¸Šå°±è¦å¥”äº”äº†ï¼ï¼ï¼ï¼ï¼ï¼ï¼</p>

<hr />

<p>ç­‰è¿™ä½ç‰›é©¬ç†¬åˆ°é€€ä¼‘äº†ï¼Œåœ¨è¿›å…¥æ£ºæä¹‹å‰ï¼Œä¸å¯¹,åœ¨åŒ–ä¸ºéª¨ç°å‰ï¼Œä¼šåœ¨è¿™è®°å½•ä¸‹è¿™å¤±è´¥çš„ä¸€ç”Ÿå§</p>

<p>To be continued!</p>]]></content><author><name>Devil</name></author><category term="æ´»ç€" /><summary type="html"><![CDATA[xxxxxxxxxxxxxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/77.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/77.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">ä½ æƒ³è¦çš„é»‘å†å²éƒ½åœ¨è¿™äº†</title><link href="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E4%BD%A0%E6%83%B3%E8%A6%81%E7%9A%84%E9%BB%91%E5%8E%86%E5%8F%B2%E9%83%BD%E5%9C%A8%E8%BF%99%E4%BA%86.html" rel="alternate" type="text/html" title="ä½ æƒ³è¦çš„é»‘å†å²éƒ½åœ¨è¿™äº†" /><published>2026-01-25T00:00:00+00:00</published><updated>2026-01-25T00:00:00+00:00</updated><id>https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E4%BD%A0%E6%83%B3%E8%A6%81%E7%9A%84%E9%BB%91%E5%8E%86%E5%8F%B2%E9%83%BD%E5%9C%A8%E8%BF%99%E4%BA%86</id><content type="html" xml:base="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E4%BD%A0%E6%83%B3%E8%A6%81%E7%9A%84%E9%BB%91%E5%8E%86%E5%8F%B2%E9%83%BD%E5%9C%A8%E8%BF%99%E4%BA%86.html"><![CDATA[<p>å¤ªå¤šäº†ï¼Œå†™ä¸è¿‡æ¥ï¼Œè¿˜æ˜¯é€‰æ‹©æ€§å¿˜è®°å§ï¼Œå°±ä¸ä¸€éç¼–åœ°åŠ æ·±é‚£äº›ç¤¾æ­»ç”»é¢çš„å°è±¡äº†ï¼Œåªè¦æˆ‘å¿˜æ‰äº†ï¼Œå°±æ²¡äººä¼šè®°å¾—äº†ï¼Œå“ˆå“ˆ</p>]]></content><author><name>Devil</name></author><category term="æ´»ç€" /><summary type="html"><![CDATA[xxxxxxxxxxxxxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/72.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/72.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">å†¥å†¥ä¹‹ä¸­è‡ªæœ‰å¤©æ„ï¼Œå¯æˆ‘å´ä¸€æ¬¡éƒ½æ²¡èƒ½æŠ“å¾—ä½</title><link href="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E5%86%A5%E5%86%A5%E4%B9%8B%E4%B8%AD%E8%87%AA%E6%9C%89%E5%A4%A9%E6%84%8F-%E5%8F%AF%E6%88%91%E5%8D%B4%E4%B8%80%E6%AC%A1%E9%83%BD%E6%B2%A1%E8%83%BD%E6%8A%93%E5%BE%97%E4%BD%8F.html" rel="alternate" type="text/html" title="å†¥å†¥ä¹‹ä¸­è‡ªæœ‰å¤©æ„ï¼Œå¯æˆ‘å´ä¸€æ¬¡éƒ½æ²¡èƒ½æŠ“å¾—ä½" /><published>2026-01-25T00:00:00+00:00</published><updated>2026-01-25T00:00:00+00:00</updated><id>https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E5%86%A5%E5%86%A5%E4%B9%8B%E4%B8%AD%E8%87%AA%E6%9C%89%E5%A4%A9%E6%84%8F%EF%BC%8C%E5%8F%AF%E6%88%91%E5%8D%B4%E4%B8%80%E6%AC%A1%E9%83%BD%E6%B2%A1%E8%83%BD%E6%8A%93%E5%BE%97%E4%BD%8F</id><content type="html" xml:base="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E5%86%A5%E5%86%A5%E4%B9%8B%E4%B8%AD%E8%87%AA%E6%9C%89%E5%A4%A9%E6%84%8F-%E5%8F%AF%E6%88%91%E5%8D%B4%E4%B8%80%E6%AC%A1%E9%83%BD%E6%B2%A1%E8%83%BD%E6%8A%93%E5%BE%97%E4%BD%8F.html"><![CDATA[<p>ä¸Šå­¦ç¬¬ä¸€æ¬¡æŠ¥é“ï¼Œå°è±¡ä¸­åªæ˜¯æ‰«äº†ä¸€çœ¼ï¼Œè‡ªå·±åˆ†åˆ°çš„é‚£ä¸ªç­ï¼Œæœ‰ä¸ªå¥³å­©çš„åå­—è¢«åˆ’æ‰äº†ï¼Œä¹‹å‰å­¦æ ¡æ‰“ç”µè¯è®©æå‰äº¤å­¦è´¹(åæ¥æ‰çŸ¥é“æ˜¯é‡ç‚¹ç­)ï¼Œä»¥ä¸ºæ˜¯è¯ˆéª—(å®åˆ™æ˜¯å› ä¸ºç©·)å°±æ²¡äº¤â€¦â€¦æ•…äº‹åº”è¯¥æ˜¯æˆ‘æƒ³çš„é‚£æ ·å§</p>

<p>å¶ç„¶é—´å‘ç°ï¼Œå¥¹è·Ÿæˆ‘æœ‰ä¸€æ ·çš„ç‰™é½¿è€¶</p>

<hr />

<p>çœŸçš„å¾ˆå¥‡æ€ªï¼Œè·Ÿæœ‰äº›äººæ‰“äº¤é“æ—¶ï¼Œä¸ä¼šè§‰å¾—æœ‰ä¸æ¯«å‹åŠ›ï¼Œå¥½åƒä¸Šè¾ˆå­å°±æ˜¯å…„å¼Ÿä¸€æ ·ã€‚</p>

<p>ä¸æ˜¯ä¸€å®¶äººï¼Œä¸è¿›ä¸€å®¶é—¨ï¼Œä¸‰è§‚ä¸åˆï¼Œæ²¡æœ‰å¿…è¦å¼ºè¡Œç‰µæ‰¯è¿‡æ·±ï¼Œå¼ºæ‰­çš„ç“œä¸ç”œï¼Œä½•å¿…ç›¸äº’æŠ˜éº½ï¼Œæ”¾è¿‡å½¼æ­¤ä¸å¥½å—ï¼Ÿ</p>

<hr />]]></content><author><name>Devil</name></author><category term="æ´»ç€" /><summary type="html"><![CDATA[xxxxxxxxxxxxxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/73.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/73.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">æœ‹å‹è¯´æˆ‘å¹²å•¥éƒ½æ˜¯ä¸¤ä¸‰å¤©</title><link href="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E6%9C%8B%E5%8F%8B%E8%AF%B4%E6%88%91%E5%B9%B2%E5%95%A5%E9%83%BD%E6%98%AF%E4%B8%A4%E4%B8%89%E5%A4%A9.html" rel="alternate" type="text/html" title="æœ‹å‹è¯´æˆ‘å¹²å•¥éƒ½æ˜¯ä¸¤ä¸‰å¤©" /><published>2026-01-25T00:00:00+00:00</published><updated>2026-01-25T00:00:00+00:00</updated><id>https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E6%9C%8B%E5%8F%8B%E8%AF%B4%E6%88%91%E5%B9%B2%E5%95%A5%E9%83%BD%E6%98%AF%E4%B8%A4%E4%B8%89%E5%A4%A9</id><content type="html" xml:base="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E6%9C%8B%E5%8F%8B%E8%AF%B4%E6%88%91%E5%B9%B2%E5%95%A5%E9%83%BD%E6%98%AF%E4%B8%A4%E4%B8%89%E5%A4%A9.html"><![CDATA[<p>è´ªå¿ƒå¦‚æˆ‘</p>

<p>å¦‚æœæˆ‘æ˜¯æ­Œæ‰‹ï¼Œæˆ‘æƒ³å¤§å£°å”±å‡ºå¿ƒä¸­å‹æŠ‘çš„æƒ…æ„Ÿï¼Œæƒ³å”±ä¸€é¦–çˆ¶äº²é€ç»™æˆ‘çš„çˆ¶äº²</p>

<p>å¦‚æœæˆ‘æ˜¯ç”»å®¶ï¼Œæˆ‘æƒ³ç”»å‡ºæœ€ç¾å¥½çš„ç”»é¢</p>

<p>å¦‚æœæˆ‘æ˜¯æ‘„å½±å¸ˆï¼Œæˆ‘æƒ³æ‹ä¸‹æœ€éœ‡æ’¼äººå¿ƒçš„å¤§è‡ªç„¶ç¾æ™¯</p>

<p>å¦‚æœæˆ‘æ˜¯ä½œå®¶ï¼Œâ€¦â€¦</p>

<hr />]]></content><author><name>Devil</name></author><category term="æ´»ç€" /><summary type="html"><![CDATA[xxxxxxxxxxxxxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/74.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/74.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">é‡ç”Ÿä¹‹æœ‰äººåœ¨é€¼æˆ‘å†™BUG</title><link href="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E9%87%8D%E7%94%9F%E4%B9%8B%E6%9C%89%E4%BA%BA%E5%9C%A8%E9%80%BC%E6%88%91%E5%86%99BUG.html" rel="alternate" type="text/html" title="é‡ç”Ÿä¹‹æœ‰äººåœ¨é€¼æˆ‘å†™BUG" /><published>2026-01-25T00:00:00+00:00</published><updated>2026-01-25T00:00:00+00:00</updated><id>https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E9%87%8D%E7%94%9F%E4%B9%8B%E6%9C%89%E4%BA%BA%E5%9C%A8%E9%80%BC%E6%88%91%E5%86%99BUG</id><content type="html" xml:base="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/25/%E9%87%8D%E7%94%9F%E4%B9%8B%E6%9C%89%E4%BA%BA%E5%9C%A8%E9%80%BC%E6%88%91%E5%86%99BUG.html"><![CDATA[<p>æ•¬ç•æ¯ä¸€è¡Œä»£ç </p>

<p>æ²¡å·¥ä½œå‰å¬åˆ°è¿™ä¸€å¥è¯ï¼Œä¼šè‚ƒç„¶èµ·æ•¬ï¼Œç°åœ¨å˜›ï¼Œè§‰å¾—åƒæ˜¯ä¸ªç¬‘è¯ï¼Œä»£ç å†™å¾—è·Ÿèš‚èšçˆ¬ä¼¼çš„ï¼Œä½ åœ¨é‚£æ•¬ç•å•¥å‘¢ä¹ˆ</p>

<hr />

<p>æˆ‘ä¸æ˜¯åœ¨æ•²ä»£ç ï¼Œè€Œæ˜¯åœ¨å†™ BUG</p>

<p>ä¹‹å‰å¯¹è¿™å¥è¯æ²¡ä»€ä¹ˆæ„Ÿè§‰ï¼Œä»Šå¤©ç»ˆäºæ‚Ÿäº†ï¼Œéœ€æ±‚ä¸€å¡Œç³Šæ¶‚ï¼Œè°ƒè¯•ç¯å¢ƒéƒ½æ²¡æœ‰ï¼Œä¸€ä¸ªåŠ²åœ°å‚¬å‚¬å‚¬ï¼Œè·Ÿå†™å°è¯´ä¸€æ ·ï¼Œæ•²å®Œäº†ç¼–è¯‘é€šè¿‡å°±æäº¤ï¼Œæƒ³éªŒè¯éƒ½æ²¡åŠæ³•ï¼Œæµ‹è¯•çš„æ—¶å€™ä¸€å¤§å †é—®é¢˜ï¼Œè¿™ä¸å°±æ˜¯å…ˆç–¯ç‹‚å†™ BUGï¼Œç„¶åå†ç–¯ç‹‚æ”¹ BUG ä¹ˆâ€¦â€¦</p>

<hr />

<p>99% çš„è®¾è®¡æ¨¡å¼éƒ½æ˜¯åœ¨æ»¥ç”¨</p>

<p>ä¸ï¼Œè¿™å¥è¯è¯´å¾—ä¸å¤ªå¯¹ï¼Œå¤ªä¿å®ˆäº†ï¼Œåº”è¯¥æ˜¯ 99.9% çš„è®¾è®¡æ¨¡å¼éƒ½åœ¨æ»¥ç”¨ï¼Œ<em>**</em>ä¹‹ç¦…ï¼Œåå­—å€’æ˜¯èµ·å¾—ä¸é”™ï¼Œå¯æƒœå†…å®¹è¿˜çœŸä¸å’‹åœ°</p>]]></content><author><name>Devil</name></author><category term="æ´»ç€" /><summary type="html"><![CDATA[xxxxxxxxxxxxxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/76.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/76.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">åŒ—äº¬åŒ—äº¬</title><link href="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/18/%E5%8C%97%E4%BA%AC%E5%8C%97%E4%BA%AC.html" rel="alternate" type="text/html" title="åŒ—äº¬åŒ—äº¬" /><published>2026-01-18T00:00:00+00:00</published><updated>2026-01-18T00:00:00+00:00</updated><id>https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/18/%E5%8C%97%E4%BA%AC%E5%8C%97%E4%BA%AC</id><content type="html" xml:base="https://xdevil.top/%E6%B4%BB%E7%9D%80/2026/01/18/%E5%8C%97%E4%BA%AC%E5%8C%97%E4%BA%AC.html"><![CDATA[<p>è®°å¾—ç¬¬ä¸€æ¬¡æ¥åŒ—äº¬æ˜¯åœ¨é«˜ä¸­çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å°è±¡ä¸­ç¬¬ä¸€æ¬¡åç«è½¦ï¼Œæ‘‡æ‘‡æ™ƒæ™ƒåœ°å°±åˆ°äº†</p>
<ul>
  <li>ç”±äºå¯¹ä»€ä¹ˆéƒ½å……æ»¡äº†æ–°å¥‡æ„Ÿï¼Œ12 ä¸ªå°æ—¶çš„ç¡¬åº§ä¹Ÿæ²¡æœ‰é‚£ä¹ˆéš¾ç†¬</li>
  <li>åˆšä¸‹ç«è½¦ï¼Œå°±è¢«å€Ÿäº†å‡ åå¤§æ´‹ï¼ŒçœŸæ˜¯å¤©çœŸçƒ‚æ¼« ğŸ˜­</li>
  <li>ä¸‰å¤©ä¸¤å¤œçœ‹äº†ä¸Šç™¾é›†çš„ç«å½±ï¼Œç®—æ˜¯ä¸ºæ•°ä¸å¤šçš„å‡ ä»¶å¯¹çš„æ—¶é—´åšäº†å¯¹çš„äº‹ä¹‹ä¸€å§ ğŸ˜‚</li>
  <li>æ‰“äº†å‡ å¤©å°çƒï¼Œè¿˜è®°å¾—å½“æ—¶å¯¹æ‰“é è¾¹çƒé¢‡æœ‰å¿ƒå¾—(æ¡Œå­æ˜¯æ–œç€çš„å§ï¼Œå“ˆå“ˆ)</li>
  <li>å§å§å¸¦ç€å»äº†å¤©å®‰é—¨ã€æ•…å®«é€›äº†é€›ï¼Œç»™ä¹°äº†ç‚¹è¡£æœä¹‹åå°±å›å»äº†</li>
</ul>

<p>ç¬¬äºŒæ¬¡æ¥åŒ—äº¬æ˜¯é«˜è€ƒ(å¿ƒé­”ä¹‹ä¸€)ç»“æŸï¼Œè·Ÿæœ‹å‹ä¸€èµ·è¿‡æ¥æ‰“æš‘å‡å·¥ï¼ŒæŒ£äº†ç‚¹ â€œå·¨æ¬¾â€</p>
<ul>
  <li>åœ¨ä¸€ä¸ªå°åˆ·å‚é‡Œé¢ï¼Œè·Ÿç€ä¸€ä¸ªäºŒåå‡ºå¤´çš„å°ä¼™åšçº¸å¼ è£åˆ‡çš„ä½“åŠ›æ´»</li>
  <li>å¯èƒ½å¿ƒæƒ…ä¸å¤ªå¥½ï¼ŒæœŸé—´è·Ÿæœ‹å‹åµæ¶äº†ï¼Œä¸è¿‡ä¹‹åå’Œå¥½äº†,å¾ˆåº†å¹¸</li>
  <li>æ™šä¸Šé€šå®µæ‰“ lolï¼Œç™½å¤©è¿·è¿·ç³Šç³Šå¹²å®Œæ´»ï¼Œå°±èº²åœ¨æ²¡äººçš„è§’è½é‡Œå·å·ç¡è§‰</li>
  <li>ç­‰å½•å–é€šçŸ¥çš„æ—¶å€™å®Œå…¨æ²¡æœ‰æŠ¥ä»»ä½•æœŸå¾…ï¼ŒUWC ä»æ¥æ²¡è®©äººå¤±æœ›(å½•æˆ‘å¹²å•¥ï¼Œè®©æˆ‘å¤è¯»ä¸å¥½ä¹ˆï¼Œæ·¦)</li>
  <li>å»æ¬¢ä¹è°·é‡Œé¢åäº†è¿‡å±±è½¦ï¼Œè·³æ¥¼æœºå•¥çš„ï¼Œç¬¬ä¸€æ¬¡ä¹Ÿæ˜¯æœ€åä¸€æ¬¡(å¹´é¾„å¤§äº†ï¼Œæ€•æ­»ä¸æ•¢ç©)</li>
  <li>è¿˜æ˜¯å§å§ï¼Œç»™ä¹°äº†è¡Œæç®±ï¼Œè¡£æœï¼Œé’±åŒ…(ç°åœ¨è¿˜åœ¨ç”¨)å•¥çš„ï¼Œå‡†å¤‡ä¸Šå¤§å­¦ï¼Œé‚£æ—¶å®Œå…¨éƒ½ä¸çŸ¥é“ä¸Šå¤§å­¦å»å¹²å•¥ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•è§„åˆ’ï¼Œå¦¥å¦¥çš„å†œæ‘å­©å­ä¸Šå¤§å­¦</li>
  <li>ç»“æŸè¦å›å»ä¸Šå­¦äº†ï¼ŒæŸ“äº†é»„å¤´å‘ï¼Œ(å¤´å‘ç‰¹åˆ«é•¿çš„é‚£ç§ï¼Œåˆ«æå¤šç¾è€»äº†ï¼Œåæ‚”æ²¡æœ‰ç…§ç‰‡)ï¼Œåæ¥å†›è®­ä¹‹å‰ç†äº†ä¸ªå¹³å¤´å‰ªæ‰äº†</li>
</ul>

<h1 id="day-one">Day One</h1>
<p>ä»Šå¹´ç¬¬äºŒæ¬¡æ¥åŒ—äº¬ï¼Œè¿™ä¸€æ¬¡ç¬¬ä¸€æ„Ÿè§‰æ˜¯ç”Ÿæ´»æˆæœ¬å¥½é«˜ï¼ŒåŒæ ·çš„ä¸€é¡¿é¥­ï¼ŒåŒ—äº¬ 21 vs è¥¿å®‰ 13ï¼Œå†ç®—ä¸Šç§Ÿæˆ¿çš„è¯ï¼Œè‡ªå·±æŒ£å¾—é‚£ç‚¹ç±³ï¼Œåœ¨è¿™è¾¹å‹æ ¹å°±æ´»ä¸ä¸‹å»ã€‚</p>

<p>ä¸Šæ¬¡æ¥è¿˜æ²¡æœ‰ä»€ä¹ˆæƒ³æ³•ï¼Œå¯èƒ½æ˜¯å› ä¸ºè™šé•¿äº†ä¸€å²ï¼Œä¼šè¿‡æ—¥å­æ‡‚å¾—çœé’±äº†ã€‚</p>

<p>æ™šä¸Šè·Ÿæœ‹å‹è§äº†é¢ï¼Œåƒäº†ä¸ªé†‰é¹…ï¼Œå›å»ç©äº†å‡ å±€æ¸¸æˆå°±æ­‡ç€äº†ã€‚</p>

<h1 id="day-two">Day Two</h1>
<p>å»äº†é¢å’Œå›­ï¼Œåœ¨æ˜†æ˜æ¹–ä¸Šæ»‘äº†åŠå¤©å†°ã€‚ äººæŒºå¤šçš„ï¼Œä¸€ä¸ªä¸ªéƒ½è·ŸäºŒå‚»å­ä¼¼çš„ï¼Œéª‘ç€å°æœ‹å‹ç©çš„å°è½¦è½¦ï¼Œå¼€å¿ƒå¾—åƒä¸ªå­©å­ã€‚</p>

<p><img src="/assets/content/47.png" alt="/assets/content/47.png" /></p>

<p><img src="/assets/content/48.png" alt="/assets/content/48.png" /></p>

<p>åŒ—äº¬æ¯”è¥¿å®‰è¿˜æ˜¯è¦å†·å¥½å¤šï¼Œæ™šä¸Šå›æ¥çš„æ—¶å€™ä¸‹é›ªäº†ï¼Œé›ªèŠ±è¿˜æŒºå¤§çš„</p>

<p><img src="/assets/content/50.png" alt="/assets/content/50.png" /></p>

<h1 id="day-three">Day Three</h1>
<p>æ˜¨å¤©ä¸‹é›ªï¼Œä»Šå¤©æ˜†æ˜æ¹–å°äº†ï¼Œåº†å¹¸æ˜¯æ˜¨å¤©å»çš„ï¼Œå“ˆå“ˆã€‚ æ‡’å¾—å‡ºå»äº†ï¼Œä¸­åˆæœ‹å‹ç»™æäº†é¡¿ï¼Œé¢è¿˜æŒºå¥½åƒçš„ï¼Œæ„Ÿè§‰äººå®¶è¿™æ‰å«ç”Ÿæ´»ï¼Œå¼¹å¼¹å‰ä»–ï¼Œå”±å”±æ­Œï¼Œå–ä¸¤å£é…’ï¼Œè‡ªå·±æç‚¹åƒçš„ï¼ŒæŒºç¾çš„ï¼Œè‡ªå·±é™¤äº† EMO å°±æ˜¯ç¡è§‰ã€‚ã€‚ã€‚</p>

<p><img src="/assets/content/49.png" alt="/assets/content/49.png" /></p>

<h1 id="ç•ªå¤–">ç•ªå¤–</h1>

<p>ä¸æ˜¯é¥­ä¸å¥½åƒï¼Œæ˜¯çœŸçš„åƒé¥­ä»æ¥æ²¡å›è¿‡æœ¬ï¼Œè‚‰åƒä¸åŠ¨ï¼Œé…’å–ä¸åŠ¨ï¼Œèƒƒå£ä¸€ç›´ä¸æ€ä¹ˆå¥½</p>

<p>æœ‹å‹å¤„ç†å·¥ä½œä¸Šçš„äº‹çš„æ—¶å€™ï¼Œæ— æ„é—´ â€œå·å¬â€ åˆ°å‡ å¥ï¼Œæ„Ÿè§‰è¦æ˜¯è‡ªå·±è¿™ç§åéª¨ä»”çš„è¯ï¼Œæ—©éƒ½ç‚¸é”…äº†ï¼Œå¯¹æ¯”ä¹‹ä¸‹ï¼Œæ´»è¯¥è‡ªå·±æ··æˆè¿™ç‹—æ ·å­ã€‚</p>

<p>éè¦ç«™ç€æŠŠé’±æŒ£äº†ï¼Œåƒä¸ªå°å­©ä¸€æ ·ä¸æˆç†Ÿï¼Œç®—äº†ç®—äº†ï¼Œå¦‚æœæ”¹å˜äº†ï¼Œé‚£æˆ‘è¿˜æ˜¯æˆ‘ä¹ˆï¼Ÿæˆ‘å°±æ˜¯æˆ‘ï¼Œä¸ä¸€æ ·çš„çƒŸç«ï¼</p>]]></content><author><name>Devil</name></author><category term="æ´»ç€" /><summary type="html"><![CDATA[æ¥åŒ—äº¬ä¸€è¶Ÿï¼Œè·Ÿä¸€ä¸ªåˆä¸­çš„è€æœ‹å‹å°èšäº†ä¸€ä¸‹ï¼Œè®°å½•ä¸‹ç”Ÿæ´»ï¼Œé¡ºä¾¿å›å¿†ä¸‹è¿‡å»]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/71.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/71.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSingular-Value-Decomposition-SVDï¼‰</title><link href="https://xdevil.top/%E6%95%B0%E5%AD%A6/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/2025/12/23/%E5%A5%87%E5%BC%82%E5%80%BC%E5%88%86%E8%A7%A3-Singular-Value-Decomposition-SVD.html" rel="alternate" type="text/html" title="å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSingular-Value-Decomposition-SVDï¼‰" /><published>2025-12-23T00:00:00+00:00</published><updated>2025-12-23T00:00:00+00:00</updated><id>https://xdevil.top/%E6%95%B0%E5%AD%A6/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/2025/12/23/%E5%A5%87%E5%BC%82%E5%80%BC%E5%88%86%E8%A7%A3%EF%BC%88Singular-Value-Decomposition-SVD%EF%BC%89</id><content type="html" xml:base="https://xdevil.top/%E6%95%B0%E5%AD%A6/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/2025/12/23/%E5%A5%87%E5%BC%82%E5%80%BC%E5%88%86%E8%A7%A3-Singular-Value-Decomposition-SVD.html"><![CDATA[<p><strong>å®å¯¹ç§°çŸ©é˜µçš„å¯¹è§’åŒ–ï¼ˆç‰¹å¾å€¼åˆ†è§£ï¼‰</strong> æ˜¯ <strong>å¥‡å¼‚å€¼åˆ†è§£</strong> çš„åŸºç¡€ï¼Œå› æ­¤ï¼Œæœ¬æ–‡åœ¨ä»‹ç»å¥‡å¼‚å€¼åˆ†è§£ä¹‹å‰å…ˆå¯¹å®å¯¹é™ˆçŸ©é˜µçš„å¯¹è§’åŒ–è¿›è¡Œå›é¡¾ã€‚æœ€åä»‹ç»å¦‚ä½•åˆ©ç”¨å¥‡å¼‚å€¼åˆ†è§£è¿›è¡Œå›¾åƒå‹ç¼©ã€‚</p>

<h2 id="1-å®å¯¹ç§°çŸ©é˜µçš„å¯¹è§’åŒ–">1 å®å¯¹ç§°çŸ©é˜µçš„å¯¹è§’åŒ–</h2>
<p><strong>å®šç†</strong> å¯¹äº $n$ é˜¶å®å¯¹é™ˆçŸ©é˜µ $A$, å¿…å­˜åœ¨æ­£äº¤çŸ©é˜µ $P$ ,ä½¿ $P^{-1}AP = P^TAP = \Lambda$ , å…¶ä¸­ $\Lambda$ æ˜¯ä»¥ $A$ çš„ $n$ ä¸ªç‰¹å¾å€¼ä¸ºå¯¹è§’å…ƒç´ çš„å¯¹è§’é˜µã€‚</p>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥ $A$ ä¸º $n$ é˜¶å®å¯¹é™ˆçŸ©é˜µï¼Œåˆ™å¯ä»¥å°†å…¶è¡¨ç¤º/åˆ†è§£ä¸ºä»¥ä¸‹å½¢å¼ï¼š
\(\begin{aligned}
A
&amp;=
P\Lambda P^{-1} \\
&amp;=
P\Lambda P^T \\
&amp;=
P
\begin{bmatrix}
\lambda_1 &amp; &amp; &amp; \\
&amp; \lambda_2 &amp; &amp; \\
&amp; &amp; \ddots &amp; \\
&amp; &amp; &amp; \lambda_n
\end{bmatrix}
P^{-1}
\end{aligned}\)
å…¶ä¸­ï¼Œ$P$ ä¸ºæ­£äº¤çŸ©é˜µï¼Œ $\lambda_i$ ä¸º $A$ çš„ç‰¹å¾å€¼ã€‚</p>

<h2 id="2-å¥‡å¼‚å€¼åˆ†è§£">2 å¥‡å¼‚å€¼åˆ†è§£</h2>
<h3 id="21-å®šä¹‰">2.1 å®šä¹‰</h3>
<p>å®é™…ä¸Šï¼Œå¯¹äºä»»æ„ $m \times n$ çš„å®çŸ©é˜µ $A$ ï¼Œå³ä½¿ $m != n$, æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œâ€œå¯¹è§’åŒ–â€œï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å¥‡å¼‚å€¼åˆ†è§£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>

<p>çŸ©é˜µ $A$ å¯ä»¥è¢«åˆ†è§£ä¸ºä»¥ä¸‹å½¢å¼ï¼š
\(A = U \Lambda V^T\)
å…¶ä¸­ $U$ å’Œ $V$ å‡ä¸ºæ­£äº¤çŸ©é˜µï¼› $U \in R^{m \times m}$ ç§°ä¸ºå·¦å¥‡å¼‚çŸ©é˜µï¼Œ $V \in R^{n \times n}$ ç§°ä¸ºå³å¥‡å¼‚çŸ©é˜µï¼›$\Lambda \in R^{m \times n}$ ä»…åœ¨ä¸»å¯¹è§’çº¿ä¸Šæœ‰å…ƒç´ ï¼Œè¿™äº›å…ƒç´ è¢«ç§°ä¸ºå¥‡å¼‚å€¼ï¼Œ $\Lambda$ ä¸€èˆ¬æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p>

<p>\(\Lambda
=
\begin{bmatrix}
\sigma_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \sigma_2 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; \ddots &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; \sigma_m &amp; 0
\end{bmatrix}\)
å¥‡å¼‚å€¼ $\sigma_i$ æ˜¯æŒ‰ä»å¤§åˆ°å°çš„é¡ºåºæ’çš„ï¼Œå³ $\sigma_1 &gt;= \sigma_2 &gt;= â€¦ &gt;= \sigma_m$ã€‚</p>

<h3 id="22-æ±‚è§£">2.2 æ±‚è§£</h3>
<p>é‚£ä¹ˆ å¦‚ä½•æ±‚è§£ $U, V, \Lambda$ å‘¢ï¼Ÿè€ƒè™‘ä»¥ä¸‹æ€§è´¨ï¼š
\(AA^T = U \Lambda V^T V\Lambda^TU^T = U\Lambda\Lambda^TU^T \\
A^TA = V\Lambda^TU^TU\Lambda V^T = V\Lambda^T\Lambda V^T\)</p>

<p>é¦–å…ˆæ˜ç¡®ä¸¤ç‚¹</p>
<ul>
  <li>$AA^T$ å’Œ $A^TA$ å‡ä¸ºå®å¯¹ç§°çŸ©é˜µï¼›</li>
  <li>$\Lambda\Lambda^T$ å’Œ $\Lambda^T\Lambda$ å‡ä¸ºå¯¹è§’é˜µï¼›</li>
</ul>

<p>å¯è§ï¼š</p>
<ul>
  <li>$U$ å®é™…ä¸Šæ˜¯å®å¯¹ç§°çŸ©é˜µ $AA^T$ å¯¹è§’åŒ–æ‰€ä½¿ç”¨çš„æ­£äº¤çŸ©é˜µï¼›</li>
  <li>$V$ å®é™…ä¸Šæ˜¯å®å¯¹ç§°çŸ©é˜µ $A^TA$ å¯¹è§’åŒ–æ‰€ä½¿ç”¨çš„æ­£äº¤çŸ©é˜µï¼›</li>
</ul>

<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<ul>
  <li>å…ˆè®¡ç®—å®å¯¹ç§°çŸ©é˜µ $AA^T$ ,ç„¶åå¯¹å…¶è¿›è¡Œå¯¹è§’åŒ–ï¼Œå¾—åˆ°æ­£äº¤çŸ©é˜µ $U$ ï¼›</li>
  <li>å…ˆè®¡ç®—å®å¯¹ç§°çŸ©é˜µ $A^TA$, ç„¶åå¯¹å…¶è¿›è¡Œå¯¹è§’åŒ–ï¼Œå¾—åˆ°æ­£äº¤çŸ©é˜µ $V$ ï¼›</li>
  <li>æœ€ç»ˆï¼Œå¾—åˆ° $A$ çš„å¥‡å¼‚å€¼åˆ†è§£ $A = U\Lambda V^T$</li>
</ul>

<h2 id="3-å¥‡å¼‚å€¼åˆ†è§£å‹ç¼©å›¾åƒ">3 å¥‡å¼‚å€¼åˆ†è§£å‹ç¼©å›¾åƒ</h2>
<p>å›¾åƒæœ¬è´¨ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œ SVD åˆ†è§£ï¼Œè¿™æ²¡æ¯›ç—…ã€‚ä½†æ˜¯åˆ©ç”¨å®ƒæ¥å‹ç¼©å›¾ç‰‡æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ã€‚</p>

<p>å‡è®¾ï¼Œä¸€å¹…å›¾åƒï¼Œå…¶åƒå¹…å¤§å°ä¸º $m * n, m &gt; n$ ï¼Œç”¨çŸ©é˜µ $M$ è¯¥å›¾åƒï¼Œå…¶ SVD åˆ†è§£ä¸º $M = U\Lambda V^T$ ã€‚</p>

<p>æŠŠ $U$ ç”¨å…¶åˆ—å‘é‡ $u_i$ ï¼ˆ $M$ çš„å·¦å¥‡å¼‚å‘é‡ï¼‰è¡¨ç¤ºä¸ºï¼š
\(U = (u_1, u_2, ..., u_n)\)</p>

<p>æŠŠ $V$ ç”¨å…¶åˆ—å‘é‡ $v_i$ ï¼ˆ $M$ çš„å³å¥‡å¼‚å‘é‡ï¼‰è¡¨ç¤ºä¸ºï¼š
\(V = (v_1, v_2, ..., v_n)\)</p>

<p>å‡è®¾ï¼Œå¯¹è§’é˜µ $\Lambda$ çš„å¯¹è§’çº¿ä¸Šå…ƒç´ ä¸º $d_i$ ï¼ˆ $M$ çš„å¥‡å¼‚å€¼ï¼‰,é‚£ä¹ˆ $M$ å¯è¢«è¡¨ç¤ºä¸ºï¼š
\(\begin{aligned}
M
&amp;=
d_1u_1v_1^T + d_2u_2v_2^T + ... + d_nu_nv_n^T\\
&amp;=
\sum_{i = 1}^{n}d_iu_iv_i^T \\
&amp;=
\sum_{i = 1}^{n}A_i
\end{aligned}\)
å…¶ä¸­ $A_i = d_iu_iv_i^T$ æ˜¯ä¸€ä¸ª $m \times n$ çš„çŸ©é˜µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æŠŠåŸæ¥çš„çŸ©é˜µ $M$ è¡¨ç¤ºæˆäº† $n$ ä¸ªçŸ©é˜µçš„å’Œã€‚</p>

<p>æ¯ä¸ªçŸ©é˜µ $A_i$ å¯¹ $M$ çš„â€œè´¡çŒ®â€æ˜¯ä¸åŒçš„ï¼Œè€Œå¥‡å¼‚å€¼ $d_i$ ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ç”¨æ¥è¡¡é‡å…¶å¯¹åº”é¡¹ $A_i$ å¯¹ $M$ â€œè´¡çŒ®â€çš„å¤§å°ã€‚</p>

<p>SVDå›¾åƒå‹ç¼©æ–¹æ³•çš„æ€è·¯å°±æ˜¯ï¼š<strong>ä» $A_i$ ä¸­æå–å‡ºé‚£äº›å¯¹ $M$ è´¡çŒ®è¾ƒå¤§çš„é¡¹ï¼ˆå¥‡å¼‚å€¼ $d_i$ è¾ƒå¤§çš„é¡¹ï¼‰ï¼ŒæŠŠå®ƒä»¬çš„å’Œä½œä¸ºå¯¹ $M$ çš„è¿‘ä¼¼</strong>ã€‚</p>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨ï¼š
\(M_k = \sum_{i = 1}^k A_i\)
æ¥å¯¹ $M_n \equiv M$ è¿›è¡Œè¿‘ä¼¼ã€‚</p>

<p>æ¥ä¸‹æ¥è®¨è®ºå‹ç¼©æ•ˆç‡ï¼š</p>
<ul>
  <li>æœªå‹ç¼©å‰ï¼šå›¾åƒéœ€è¦å­˜å‚¨ $m * n$ ä¸ªå…ƒç´ ï¼›</li>
  <li>å‹ç¼©åï¼šåªéœ€è¦å­˜å‚¨ $U$ çš„å‰ $k$ åˆ— $u_1,u_2,â€¦,u_k$ ã€ $V$ çš„å‰ $k$ åˆ— $v_1,v_2,â€¦,v_k$ ã€$\Lambda$ çš„å‰ $k$ ä¸ªå…ƒç´  $d_1,d_2,â€¦,d_k$ ï¼Œå…±éœ€å­˜å‚¨ $k(m + n + 1)$ ä¸ªå…ƒç´ ï¼›</li>
</ul>

<p>å› æ­¤ï¼Œå›¾åƒçš„å‹ç¼©æ¯”å…¬å¼ä¸ºï¼š
\(\rho = \frac{k(m + n + 1)}{mn}\)</p>

<p>æœ¬æ–‡åŸºäº OpenCV è¿›è¡Œäº†å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;opencv2/core/core.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;opencv2/highgui/highgui.hpp&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">Mat</span> <span class="nf">svd_compress</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span><span class="o">&amp;</span> <span class="n">src_channel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Mat</span> <span class="n">temp</span><span class="p">;</span>
    <span class="n">src_channel</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">CV_32FC1</span><span class="p">);</span>
    
    <span class="n">Mat</span> <span class="n">U</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Vt</span><span class="p">;</span>
    <span class="c1">//opencvå¾—åˆ°çš„Vå·²ç»ç»è¿‡è½¬ç½®äº†</span>
    <span class="c1">//wä¸ºä¸€ä¸ªè¡ŒçŸ©é˜µï¼Œè€Œéå¯¹è§’é˜µ</span>
    <span class="n">SVD</span><span class="o">::</span><span class="n">compute</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">Vt</span><span class="p">);</span>

    <span class="n">Mat</span> <span class="n">res</span><span class="p">(</span><span class="n">src_channel</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">CV_32FC1</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">w</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">U</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">Vt</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="p">}</span>
    
    <span class="cm">/*Mat W(w.rows, w.rows, CV_32FC1, Scalar(0));
    for (int i = 0; i &lt; k; i++)
        W.ptr&lt;float&gt;(i)[i] = w.ptr&lt;float&gt;(i)[0];
    res = U * W * Vt;*/</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Mat</span> <span class="n">src</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">"../data/1.jpg"</span><span class="p">);</span>
    <span class="n">imshow</span><span class="p">(</span><span class="s">"åŸå›¾"</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">src_channels</span><span class="p">;</span>
    <span class="n">split</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">src_channels</span><span class="p">);</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">dst_channels</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">channels</span><span class="p">());</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">src_channels</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">dst_channels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">svd_compress</span><span class="p">(</span><span class="n">src_channels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">);</span>
        <span class="n">dst_channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">convertTo</span><span class="p">(</span><span class="n">dst_channels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">CV_8UC1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Mat</span> <span class="n">dst</span><span class="p">;</span>
    <span class="n">merge</span><span class="p">(</span><span class="n">dst_channels</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
    <span class="n">imshow</span><span class="p">(</span><span class="s">"å‹ç¼©å›¾"</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
    <span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ä»¥ä¸‹ä¸ºå®ç°æ•ˆæœå›¾ï¼š</p>

<p>åŸå›¾ï¼Œ1080 * 1920ï¼š
<img src="/assets/content/24.jpg" alt="/assets/content/24.jpg" /></p>

<p>$k = 1$ , å‹ç¼©æ¯”ï¼š $0.0014$
<img src="/assets/content/25.jpg" alt="/assets/content/25.jpg" /></p>

<p>$k = 5$ , å‹ç¼©æ¯”ï¼š $0.0072$
<img src="/assets/content/26.jpg" alt="/assets/content/26.jpg" /></p>

<p>$k = 100$ , å‹ç¼©æ¯”ï¼š $0.1447$
<img src="/assets/content/27.jpg" alt="/assets/content/27.jpg" /></p>

<p>$k = 500$, å‹ç¼©æ¯”ï¼š $0.7236$
<img src="/assets/content/28.jpg" alt="/assets/content/28.jpg" /></p>

<p>å½“ k = 500 æ—¶ï¼Œå‹ç¼©åçš„å›¾åƒä¸åŸå›¾çœ‹èµ·æ¥åŸºæœ¬ä¸€æ ·ï¼Œæ­¤æ—¶å‹ç¼©æ¯”ä¸º 0.7236ï¼Œå¯è§ï¼Œå‹ç¼©æ•ˆç‡è¿˜æ˜¯æŒºå¥½çš„ã€‚</p>

<table>
  <tbody>
    <tr>
      <td>æ€è€ƒï¼šå‡è®¾ï¼Œæˆ‘ä»¬ä½¿ç”¨ $</td>
      <td>Â </td>
      <td>M_k - M_n</td>
      <td>Â </td>
      <td>_2$ æ¥ä½œä¸ºè¯„ä»·è¿‘ä¼¼ç»“æœå¥½åçš„æŒ‡æ ‡ï¼› æ˜¾ç„¶ï¼Œå½“ $k = n$ æ—¶ï¼Œè¿‘ä¼¼æ•ˆæœæœ€å¥½ï¼›é‚£ä¹ˆå½“ $k != n$ æ—¶ï¼Œ$k$ å–ä»€ä¹ˆå€¼çš„æ—¶å€™ï¼Œè¿‘ä¼¼æ•ˆæœæœ€å¥½ï¼Ÿ</td>
    </tr>
  </tbody>
</table>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://www.cnblogs.com/endlesscoding/p/10033527.html">https://www.cnblogs.com/endlesscoding/p/10033527.html</a></p>

<p><a href="https://cosx.org/2014/02/svd-and-image-compression">https://cosx.org/2014/02/svd-and-image-compression</a></p>]]></content><author><name>Devil</name></author><category term="æ•°å­¦" /><category term="çº¿æ€§ä»£æ•°" /><category term="å¥‡å¼‚å€¼åˆ†è§£" /><category term="å›¾åƒå¤„ç†" /><summary type="html"><![CDATA[xxxxxxxxxxxxxxxxxx]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/70.png" /><media:content medium="image" url="https://xdevil.top/assets/image/70.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">çº¿æ®µæ ‘ï¼ˆSegment Treeï¼‰</title><link href="https://xdevil.top/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/2025/10/28/%E7%BA%BF%E6%AE%B5%E6%A0%91-Segment-Tree.html" rel="alternate" type="text/html" title="çº¿æ®µæ ‘ï¼ˆSegment Treeï¼‰" /><published>2025-10-28T00:00:00+00:00</published><updated>2025-10-28T00:00:00+00:00</updated><id>https://xdevil.top/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/2025/10/28/%E7%BA%BF%E6%AE%B5%E6%A0%91%EF%BC%88Segment%20Tree%EF%BC%89</id><content type="html" xml:base="https://xdevil.top/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/2025/10/28/%E7%BA%BF%E6%AE%B5%E6%A0%91-Segment-Tree.html"><![CDATA[<p>åœ¨è§£å†³ rmq é—®é¢˜çš„æ•°æ®ç»“æ„ä¸­ï¼Œçº¿æ®µæ ‘å±äºæ˜¯ <strong>é‡æ­¦å™¨ï¼š</strong> æ•ˆç‡ç•¥ä½ï¼Œä½†åŠŸèƒ½å¼ºå¤§ï¼Œå¸¸ç”¨äºè§£å†³å¤æ‚çš„ â€œå•ç‚¹æ›´æ–° + åŒºé—´æŸ¥è¯¢â€ å’Œ â€œåŒºé—´æ›´æ–° + åŒºé—´æŸ¥è¯¢â€ é—®é¢˜ï¼Œåˆ‡å‹¿æ€é¸¡ç”¨ç‰›åˆ€ã€‚</p>

<h1 id="çº¿æ®µæ ‘ç±»å‹">çº¿æ®µæ ‘ç±»å‹</h1>
<h2 id="é€’å½’çº¿æ®µæ ‘">é€’å½’çº¿æ®µæ ‘</h2>
<p>è‡ªé¡¶å‘ä¸‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„çº¿æ®µæ ‘ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·å­çš„:</p>
<ul>
  <li>ä¸€æ£µæ»¡äºŒå‰æ ‘ä¸‹ï¼Œç¨€ç–åœ°æŒ‚ç€å¥½å¤šå°è„šï¼ˆéè¿ç»­ï¼‰</li>
  <li>åŸæ•°æ®å­˜å‚¨åœ¨å€’æ•°ä¸¤å±‚çš„å¶å­èŠ‚ç‚¹å½“ä¸­</li>
  <li>æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹éƒ½æœ‰å·¦å³å­èŠ‚ç‚¹</li>
  <li>å€’æ•°ç¬¬äºŒå±‚ä¸€å®šæ˜¯æ»¡çš„ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</li>
</ul>

<p>åŸç†ï¼šå¯¹äºé•¿åº¦ä¸º <code class="language-plaintext highlighter-rouge">n</code> çš„åŸæ•°ç»„ <code class="language-plaintext highlighter-rouge">nums</code>ï¼Œé€’å½’çº¿æ®µæ ‘</p>
<ul>
  <li>1 å·èŠ‚ç‚¹ç»´æŠ¤çš„æ˜¯åŒºé—´ <code class="language-plaintext highlighter-rouge">[0, n - 1]</code> çš„å±æ€§å€¼</li>
  <li>2 å·èŠ‚ç‚¹ç»´æŠ¤çš„æ˜¯åŒºé—´ <code class="language-plaintext highlighter-rouge">[0, mid]</code> çš„å±æ€§å€¼, <code class="language-plaintext highlighter-rouge">mid = (0 + (n - 1)) / 2</code></li>
  <li>3 å·èŠ‚ç‚¹ç»´æŠ¤çš„æ˜¯åŒºé—´ <code class="language-plaintext highlighter-rouge">[mid, n - 1]</code> çš„å±æ€§å€¼, <code class="language-plaintext highlighter-rouge">mid = (0 + (n - 1)) / 2</code></li>
  <li>â€¦â€¦</li>
</ul>

<p><img src="/assets/content/22.png" alt="/assets/content/22.png" /></p>

<h2 id="è¿­ä»£çº¿æ®µæ ‘">è¿­ä»£çº¿æ®µæ ‘</h2>

<p>è‡ªåº•å‘ä¸Šï¼Œæ”¯æŒæ‡’æ ‡è®°ä¸‹æ²‰æ“ä½œå›°éš¾:æ°¸è¿œæ˜¯ä¸€æ£µ <strong>æ»¡äºŒå‰æ ‘</strong>ï¼ŒåŸæ•°æ®åœ¨æœ€åä¸€å±‚ä»å·¦å¾€å³å­˜å‚¨ï¼Œå‰©ä½™ç”¨ä¸åˆ°çš„å¿…é¡»ç”¨å•ä½å…ƒå¡«å……</p>

<p><img src="/assets/content/23.png" alt="/assets/content/23.png" /></p>

<h1 id="å•ç‚¹ä¿®æ”¹--åŒºé—´æŸ¥è¯¢">å•ç‚¹ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢</h1>
<h2 id="è¿­ä»£çº¿æ®µæ ‘æ¨è">è¿­ä»£çº¿æ®µæ ‘ï¼ˆæ¨èï¼‰</h2>

<p>æ”¯æŒ plus, multiple, min, max, and, or, xor, gcd, lcm ç­‰æ“ä½œ, å‰å››è€…ä¹Ÿæ”¯æŒæµ®ç‚¹ç±»å‹</p>

<p>æ”¯æŒ â€œè®¾ç½®æ›´æ–°ï¼ˆsetï¼‰â€ å’Œ â€œå¢é‡æ›´æ–°ï¼ˆupdateï¼‰â€ ä¸¤ç§æ“ä½œï¼ˆæ ‘çŠ¶æ•°ç»„åªæ”¯æŒå‰è€…ï¼Œæ•…åº”ç”¨åœºæ™¯å—é™ï¼‰</p>
<ul>
  <li>è®¾ç½®æ›´æ–°ï¼šä½¿ç”¨ä¸€ä¸ªæ–°å€¼æ›¿æ¢æ—§å€¼ï¼Œå®Œå…¨ç§»é™¤æ—§æœ‰å…ƒç´ å½±å“</li>
  <li>å¢é‡æ›´æ–°ï¼šåœ¨æ—§å€¼çš„åŸºç¡€ä¸Šæ›´æ–°ä¸ºæ–°å€¼ï¼Œæ—§æœ‰å…ƒç´ çš„å½±å“æ²¡æœ‰è¢«ç§»</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// identity variable template(C++14)</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">Op</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>

<span class="c1">// std::plus partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">plus</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// std::multiplies partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">multiplies</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// std::bit_and partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_and</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">~</span><span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// std::bit_or partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_or</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// std::bit_xor partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_xor</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// maximum partial variable template specialization</span>
<span class="c1">// std::maximum is function template, not types of functors</span>
<span class="c1">// float type should use lowest() instead of min()</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Max</span>  <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// template&lt;typename T&gt; constexpr auto identity_value&lt;Max , T&gt; = std::is_floating_point_v&lt;T&gt; ? std::numeric_limits&lt;T&gt;::lowest() : std::numeric_limits&lt;T&gt;::min();</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Max</span> <span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">lowest</span><span class="p">();</span>

<span class="c1">// minimum partial variable template specialization</span>
<span class="c1">// std::min is function template, not types of functors</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Min</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Min</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>

<span class="c1">// gcd partial variable template specialization</span>
<span class="c1">// std::gcd(c++17) is function template, not types of functors</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Gcd</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">gcd</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Gcd</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// lcm partial variable template specialization</span>
<span class="c1">// std::lcm(c++17) is function template, not types of functors</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Lcm</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">lcm</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Lcm</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">Op</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">SegmentTree</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">explicit</span> <span class="n">SegmentTree</span><span class="p">(</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">init_value</span> <span class="o">=</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">:</span> <span class="n">_n</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">_tree</span><span class="p">(</span><span class="n">base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">_op</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// init leaf nodes</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">_tree</span><span class="p">[</span><span class="n">base</span><span class="p">()</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_value</span><span class="p">;</span>

        <span class="c1">// init inner nodes</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="n">base</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="n">_tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span> <span class="n">_tree</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">i</span><span class="p">)]);</span>
    <span class="p">}</span>

    <span class="k">explicit</span> <span class="nf">SegmentTree</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">nums</span><span class="p">)</span> <span class="o">:</span> <span class="n">_n</span><span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">_tree</span><span class="p">(</span><span class="n">base</span><span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">_op</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// init leaf nodes</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">_tree</span><span class="p">[</span><span class="n">base</span><span class="p">()</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="c1">// init inner nodes</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="n">base</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="n">_tree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span> <span class="n">_tree</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">i</span><span class="p">)]);</span>
    <span class="p">}</span>

    <span class="c1">// only support const version, non const version maybe destroy inner structure</span>
    <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">idx</span><span class="p">)</span> <span class="k">const</span> <span class="k">noexcept</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_tree</span><span class="p">[</span><span class="n">base</span><span class="p">()</span> <span class="o">+</span> <span class="n">idx</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// 0-indexed setting update</span>
    <span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="kt">int</span> <span class="kt">size_t</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="k">noexcept</span> <span class="p">{</span>
        <span class="n">_tree</span><span class="p">[</span><span class="n">idx</span> <span class="o">+=</span> <span class="n">base</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>

        <span class="c1">// update form bottom to top idx [2, x)</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">idx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">_tree</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]);</span>
    <span class="p">}</span>

    <span class="c1">// 0-indexed incremental update</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">idx</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="k">noexcept</span> <span class="p">{</span>
        <span class="n">set</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">_op</span><span class="p">(</span><span class="k">operator</span><span class="p">[](</span><span class="n">idx</span><span class="p">),</span> <span class="n">value</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// 0-indexed range query [p, r]</span>
    <span class="n">T</span> <span class="n">query</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">r</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="c1">// special scene should return identity</span>
        <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">r</span> <span class="o">||</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="n">_n</span><span class="p">)</span> <span class="k">return</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>

        <span class="c1">// void Out-of-bounds access</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">_n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>

        <span class="n">T</span> <span class="n">res_left</span> <span class="o">=</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">res_right</span> <span class="o">=</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span> <span class="o">+=</span> <span class="n">base</span><span class="p">(),</span> <span class="n">r</span> <span class="o">+=</span> <span class="n">base</span><span class="p">();</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">;</span> <span class="n">p</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// p is right child node</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">res_left</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">res_left</span><span class="p">,</span> <span class="n">_tree</span><span class="p">[</span><span class="n">p</span><span class="o">++</span><span class="p">]);</span>
            <span class="c1">// r is left child node</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">r</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span> <span class="n">res_right</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">r</span><span class="o">--</span><span class="p">],</span> <span class="n">res_right</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nf">_op</span><span class="p">(</span><span class="n">res_left</span><span class="p">,</span> <span class="n">res_right</span><span class="p">);</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="kt">size_t</span> <span class="n">base</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_tree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">size_t</span> <span class="n">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_n</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">static</span> <span class="kt">size_t</span> <span class="nf">base</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="kt">size_t</span> <span class="n">base</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">while</span> <span class="p">(</span><span class="n">base</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="n">base</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">return</span> <span class="n">base</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">static</span> <span class="kt">size_t</span> <span class="nf">left</span><span class="p">(</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">static</span> <span class="kt">size_t</span> <span class="nf">right</span><span class="p">(</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>

    <span class="kt">size_t</span> <span class="n">_n</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">_tree</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">_op</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>å‡è®¾æ•°ç»„çš„é•¿åº¦æ˜¯ 10, å¯¹äº [9, 3], [-5, 4], [1, 20], [-5, 30] è¿™äº›å¼‚å¸¸åŒºé—´æŸ¥è¯¢å¦‚ä½•å¤„ç†</p>
<ul>
  <li>é»˜è®¤å¤„ç†ï¼š[9, 3] è¿™ç§ï¼Œè¿”å›å•ä½å…ƒå³å¯ï¼›å¯¹äº [-5, 30] è¿™ç§ï¼Œå¤„ç†æˆ [0, 9] å³å¯ï¼Œå…¶ä»–ä½ç½®çš„å…ƒç´ éƒ½å¯ä»¥çœ‹ä½œæ˜¯å•ä½å…ƒ</li>
  <li>æŠ›å‡ºå¼‚å¸¸ï¼šç”¨æˆ·éœ€è¦æå‰è¯†åˆ«å¼‚å¸¸æŸ¥è¯¢åŒºé—´ï¼Œå¹¶è‡ªå®šä¹‰è¯¥åœºæ™¯ä¸‹çš„è¿”å›å€¼ï¼Œä½œä¸ºæ¥å£ä½¿ç”¨èµ·æ¥ä½“éªŒä¸ä½³</li>
  <li>æ€»ç»“ï¼šé»˜è®¤å¤„ç†çš„å®ç°æ˜¯åˆç†çš„ï¼Œä¸”ä¹Ÿå¯ä»¥æå‰è¯†åˆ«å¼‚å¸¸åŒºé—´è‡ªå®šä¹‰è¿”å›ç»“æœï¼Œæ•…å®ç°é‡‡ç”¨é»˜è®¤å¤„ç†</li>
</ul>

<p>æœªä½¿ç”¨çš„å¶å­èŠ‚ç‚¹åº”è¯¥è¢«åˆå§‹åŒ–ä¸ºå•ä½å…ƒï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å†…éƒ¨èŠ‚ç‚¹åˆå§‹åŒ–é”™è¯¯</p>

<h2 id="é€’å½’çº¿æ®µæ ‘ä¸æ¨è">é€’å½’çº¿æ®µæ ‘ï¼ˆä¸æ¨èï¼‰</h2>
<p>é™¤äº†æ•ˆç‡ä½ç‚¹ï¼Œå…¶å®ƒè·Ÿè¿­ä»£çº¿æ®µæ ‘æ²¡æœ‰ä»»ä½•åŒºåˆ«</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// identity variable template(C++14)</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">Op</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>

<span class="c1">// std::plus partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">plus</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// std::multiplies partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">multiplies</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// std::bit_and partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_and</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">~</span><span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// std::bit_or partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_or</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// std::bit_xor partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_xor</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// maximum partial variable template specialization</span>
<span class="c1">// std::maximum is function template, not types of functors</span>
<span class="c1">// float type should use lowest() instead of min()</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Max</span>  <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// template&lt;typename T&gt; constexpr auto identity_value&lt;Max , T&gt; = std::is_floating_point_v&lt;T&gt; ? std::numeric_limits&lt;T&gt;::lowest() : std::numeric_limits&lt;T&gt;::min();</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Max</span> <span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">lowest</span><span class="p">();</span>

<span class="c1">// minimum partial variable template specialization</span>
<span class="c1">// std::min is function template, not types of functors</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Min</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Min</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>

<span class="c1">// gcd partial variable template specialization</span>
<span class="c1">// std::gcd(c++17) is function template, not types of functors</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Gcd</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">gcd</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Gcd</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// lcm partial variable template specialization</span>
<span class="c1">// std::lcm(c++17) is function template, not types of functors</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Lcm</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">lcm</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Lcm</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">Op</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">SegmentTree</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">explicit</span> <span class="n">SegmentTree</span><span class="p">(</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">init_value</span> <span class="o">=</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">:</span> <span class="n">_tree</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">_op</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">init_value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">explicit</span> <span class="nf">SegmentTree</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">nums</span><span class="p">)</span> <span class="o">:</span> <span class="n">_tree</span><span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">_op</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    
    <span class="c1">// only support const version</span>
    <span class="k">const</span> <span class="n">T</span> <span class="k">operator</span><span class="p">[](</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">idx</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 0-indexed</span>
    <span class="kt">void</span> <span class="nf">set</span><span class="p">(</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">idx</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// çº¿æ®µæ ‘ 1 å·èŠ‚ç‚¹ï¼Œç»´æŠ¤æ•´ä¸ªæ•°ç»„ä¿¡æ¯</span>
        <span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 0-indexed</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">idx</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// çº¿æ®µæ ‘ 1 å·èŠ‚ç‚¹ï¼Œç»´æŠ¤æ•´ä¸ªæ•°ç»„ä¿¡æ¯</span>
        <span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 0-indexed</span>
    <span class="n">T</span> <span class="nf">query</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">r</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="k">const</span> <span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">();</span>
        <span class="c1">// special scene should return identity</span>
        <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">r</span> <span class="o">||</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">)</span> <span class="k">return</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>

        <span class="c1">// void Out-of-bounds access</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        
        <span class="k">return</span> <span class="nf">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">static</span> <span class="kt">size_t</span> <span class="nf">left</span><span class="p">(</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">static</span> <span class="kt">size_t</span> <span class="nf">right</span><span class="p">(</span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">size_t</span> <span class="n">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_tree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">//idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡, [p, r] ç»´æŠ¤åŒºé—´, x æ›´æ–°ä½ç½® 0-indexed, val å¢é‡/ä¿®æ”¹åçš„å€¼</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">idx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span> <span class="n">val</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">is_set</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// åˆ°è¾¾å¶èŠ‚ç‚¹</span>
        <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_set</span> <span class="o">?</span> <span class="n">val</span> <span class="o">:</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">val</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">size_t</span> <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æ›´æ–°ä½ç½®ä¸å·¦åŠç»´æŠ¤åŒºé—´æœ‰äº¤é›†</span>
            <span class="n">update</span><span class="p">(</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">is_set</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// æ›´æ–°ä½ç½®ä¸å³åŠç»´æŠ¤åŒºé—´æœ‰äº¤é›†</span>
            <span class="n">update</span><span class="p">(</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">is_set</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// å›æº¯</span>
        <span class="n">_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">_tree</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]);</span>
    <span class="p">}</span>

    <span class="c1">//idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡, [p, r] ç»´æŠ¤åŒºé—´, [x, y]æŸ¥è¯¢åŒºé—´ 0-indexed</span>
    <span class="n">T</span> <span class="n">query</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">idx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">y</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="c1">// ç»´æŠ¤åŒºé—´åœ¨æŸ¥è¯¢åŒºé—´èŒƒå›´å†…</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">)</span> <span class="k">return</span> <span class="n">_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>

        <span class="kt">size_t</span> <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">T</span> <span class="n">res</span> <span class="o">=</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æŸ¥è¯¢åŒºé—´ä¸å·¦åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">query</span><span class="p">(</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æŸ¥è¯¢åŒºé—´ä¸å³åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">query</span><span class="p">(</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">_tree</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">_op</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<h1 id="åŒºé—´ä¿®æ”¹--åŒºé—´æŸ¥è¯¢">åŒºé—´ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢</h1>
<h2 id="é€’å½’çº¿æ®µæ ‘æ¨èto-check">é€’å½’çº¿æ®µæ ‘ï¼ˆæ¨èï¼‰ï¼ˆto checkï¼‰</h2>

<p>ä¸ºäº†æ”¯æŒå¿«é€ŸåŒºé—´ä¿®æ”¹ï¼Œçº¿çŸ­æ ‘å¼•å…¥ <strong>æ‡’æ ‡è®°</strong></p>

<ul>
  <li>æ‡’æ ‡è®°ï¼šåŒºé—´ä¿®æ”¹æ—¶ï¼Œåªæ˜¯è¿›è¡Œç®€å•æ ‡è®°ï¼Œå¹¶ä¸å°†ä¿®æ”¹å®é™…ç”Ÿæ•ˆåˆ°æ¯ä¸ªå…ƒç´ ï¼›åœ¨æŸ¥è¯¢å‰ï¼Œä¼šå°†æ ‡è®°ä¸‹æ²‰ï¼Œä½¿å¾—ä¿®æ”¹ç”Ÿæ•ˆã€‚</li>
  <li>ä¸ä½¿ç”¨æ‡’æ ‡è®°çš„åŒºé—´ä¿®æ”¹æ—¶é—´å¤æ‚åº¦ä¸ºçº¿æ€§ï¼Œä½¿ç”¨åå¯è¾¾åˆ° $O(log(n))$</li>
</ul>

<p>æ”¯æŒåŒºé—´å’Œã€åŒºé—´æœ€å¤§/å°å€¼</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// identity variable template(C++14)</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">Op</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>

<span class="c1">// std::plus partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">plus</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// std::multiplies partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">multiplies</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// std::bit_and partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_and</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">~</span><span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// std::bit_or partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_or</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// std::bit_xor partial variable template specialization</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_xor</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// maximum partial variable template specialization</span>
<span class="c1">// std::maximum is function template, not types of functors</span>
<span class="c1">// float type should use lowest() instead of min()</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Max</span>  <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// template&lt;typename T&gt; constexpr auto identity_value&lt;Max , T&gt; = std::is_floating_point_v&lt;T&gt; ? std::numeric_limits&lt;T&gt;::lowest() : std::numeric_limits&lt;T&gt;::min();</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Max</span> <span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">lowest</span><span class="p">();</span>

<span class="c1">// minimum partial variable template specialization</span>
<span class="c1">// std::min is function template, not types of functors</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Min</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Min</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>

<span class="c1">// gcd partial variable template specialization</span>
<span class="c1">// std::gcd(c++17) is function template, not types of functors</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Gcd</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">gcd</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Gcd</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// lcm partial variable template specialization</span>
<span class="c1">// std::lcm(c++17) is function template, not types of functors</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">struct</span> <span class="nc">Lcm</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">lcm</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Lcm</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">Op</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">Magic</span> <span class="p">{</span>
    <span class="k">static</span> <span class="n">T</span> <span class="n">merge</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">Magic</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">plus</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">static</span> <span class="n">T</span> <span class="n">merge</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span> <span class="o">*</span> <span class="n">len</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">Magic</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">multiplies</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">static</span> <span class="n">T</span> <span class="n">merge</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pow</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">Magic</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">bit_xor</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">static</span> <span class="n">T</span> <span class="n">merge</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">len</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="n">val</span> <span class="o">:</span> <span class="n">T</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">&gt;</span> <span class="k">class</span> <span class="nc">Op</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">SegmentTree</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">explicit</span> <span class="n">SegmentTree</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">init_value</span> <span class="o">=</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">_tree</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">_tag</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">_op</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">init_value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">explicit</span> <span class="nf">SegmentTree</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">nums</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">_tree</span><span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">_tag</span><span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">_op</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// 0-indexed</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">();</span>
        <span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 0-indexed</span>
    <span class="n">T</span> <span class="nf">query</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="nf">left</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="nf">right</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="nf">mid</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">size_t</span> <span class="n">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_tree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">// æ‡’æ ‡è®°ä¸‹æ²‰, idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡ [p, r] ç»´æŠ¤åŒºé—´ 0-indexed</span>
    <span class="kt">void</span> <span class="nf">down</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">_tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="c1">// å·¦ç»´æŠ¤åŒºé—´ä¸‹æ²‰</span>
        <span class="n">_tree</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">Magic</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">merge</span><span class="p">(</span><span class="n">_tag</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">q</span> <span class="o">-</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
        <span class="n">_tag</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tag</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">_tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>

        <span class="c1">// å³ç»´æŠ¤åŒºé—´ä¸‹æ²‰</span>
        <span class="n">_tree</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">Magic</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">merge</span><span class="p">(</span><span class="n">_tag</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">r</span> <span class="o">-</span> <span class="n">q</span><span class="p">));</span>
        <span class="n">_tag</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tag</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">_tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>

        <span class="n">_tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡ [p, r] ç»´æŠ¤åŒºé—´, [x, y] æ›´æ–°åŒºé—´ 0-indexed z å¢é‡</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// èŠ‚ç‚¹ç»´æŠ¤åŒºé—´åœ¨æ›´æ–°åŒºé—´èŒƒå›´å†…</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">Magic</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">merge</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
            <span class="n">_tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tag</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">val</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// æ‡’æ ‡è®°ä¸‹æ²‰</span>
        <span class="n">down</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æ›´æ–°åŒºé—´å’Œå·¦åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">update</span><span class="p">(</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æ›´æ–°åŒºé—´å’Œå³åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">update</span><span class="p">(</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// å›æº¯</span>
        <span class="n">_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">_tree</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">_tree</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]);</span>
    <span class="p">}</span>

    <span class="n">T</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// èŠ‚ç‚¹ç»´æŠ¤åŒºé—´åœ¨æŸ¥è¯¢åŒºé—´èŒƒå›´å†…</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">)</span> <span class="k">return</span> <span class="n">_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>

        <span class="c1">// æ‡’æ ‡è®°ä¸‹æ²‰</span>
        <span class="n">down</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="n">T</span> <span class="n">res</span> <span class="o">=</span> <span class="n">identity_value</span><span class="o">&lt;</span><span class="n">Op</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æŸ¥è¯¢åŒºé—´å’Œå·¦åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">query</span><span class="p">(</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æŸ¥è¯¢åŒºé—´å’Œå³åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">_op</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">query</span><span class="p">(</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">_tree</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">_tag</span><span class="p">;</span>
    <span class="n">Op</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">_op</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>ä¸ºä»€ä¹ˆåœ¨ <code class="language-plaintext highlighter-rouge">update</code> çš„æ—¶å€™ä¹Ÿéœ€è¦æ‡’æ ‡è®°ä¸‹æ²‰ï¼Ÿï¼Ÿ</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">update</code> å›æº¯çš„æ—¶å€™ä¼šæ›´æ–°åŒºé—´ä¿¡æ¯ã€‚ä¸ºä»€ä¹ˆå›æº¯çš„æ—¶å€™éœ€è¦ <code class="language-plaintext highlighter-rouge">update</code> ï¼Ÿï¼Ÿï¼Ÿ</li>
  <li>æ²¡æœ‰ä¸‹æ²‰ä¼šå¯¼è‡´å·¦å³å­æ ‘çš„ä¿¡æ¯ç¼ºå¤±ï¼Œæœ€ç»ˆå¯¼è‡´å›æº¯åˆ°çˆ¶èŠ‚ç‚¹ä¿¡æ¯ç¼ºå¤±ã€‚</li>
</ul>

<h2 id="è¿­ä»£çº¿æ®µæ ‘ä¸æ¨è">è¿­ä»£çº¿æ®µæ ‘ï¼ˆä¸æ¨èï¼‰</h2>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<h1 id="ç»ƒä¹ ">ç»ƒä¹ </h1>

<p><a href="https://leetcode.cn/problems/longest-increasing-subsequence-ii">LeetCode 2407. æœ€é•¿é€’å¢å­åºåˆ— II</a></p>

<p><a href="https://www.luogu.com.cn/problem/P3372">P3372 ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 1</a></p>

<p><a href="https://leetcode.cn/problems/handling-sum-queries-after-update/">2569. æ›´æ–°æ•°ç»„åå¤„ç†æ±‚å’ŒæŸ¥è¯¢</a></p>

<h1 id="å°è£…">å°è£…</h1>

<p>0 indexed</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Tp</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">Sequence</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Tp</span><span class="p">&gt;,</span>
    <span class="k">typename</span> <span class="n">Calculate</span> <span class="o">=</span> <span class="n">plus</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="k">typename</span> <span class="n">Accumulate</span> <span class="o">=</span> <span class="n">Accumulate</span><span class="o">&lt;</span><span class="n">Calculate</span><span class="o">&gt;&gt;</span>
<span class="k">class</span> <span class="nc">SegmentTree</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">value_type</span> <span class="n">value_type</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">reference</span> <span class="n">reference</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">const_reference</span> <span class="n">const_reference</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">size_type</span> <span class="n">size_type</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="n">Sequence</span> <span class="n">container_type</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="n">Calculate</span> <span class="n">value_calculate</span><span class="p">;</span>
<span class="nl">private:</span>
    <span class="k">const</span> <span class="n">value_type</span> <span class="n">init_val</span><span class="p">;</span>
    <span class="c1">//æ‡’æ ‡è®°</span>
    <span class="n">container_type</span> <span class="n">tag</span><span class="p">;</span>
    <span class="c1">//çº¿æ®µæ ‘</span>
    <span class="n">container_type</span> <span class="n">seg</span><span class="p">;</span>
    <span class="n">Calculate</span> <span class="n">cal</span><span class="p">;</span>
    <span class="n">Accumulate</span> <span class="n">acc</span><span class="p">;</span>
<span class="nl">public:</span>
    <span class="k">explicit</span> <span class="n">SegmentTree</span><span class="p">(</span><span class="n">size_type</span> <span class="n">n</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span> <span class="o">=</span> <span class="n">value_type</span><span class="p">())</span>
        <span class="o">:</span> <span class="n">init_val</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">tag</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">),</span> <span class="n">seg</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">explicit</span> <span class="nf">SegmentTree</span><span class="p">(</span><span class="k">const</span> <span class="n">Sequence</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span> <span class="o">=</span> <span class="n">value_type</span><span class="p">())</span>
        <span class="o">:</span> <span class="n">init_val</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">tag</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">),</span> <span class="n">seg</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">size_type</span> <span class="n">n</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="k">for</span><span class="p">(</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">InputIterator</span><span class="p">&gt;</span>
    <span class="k">explicit</span> <span class="nf">SegmentTree</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span> <span class="o">=</span> <span class="n">value_type</span><span class="p">())</span>
        <span class="o">:</span> <span class="n">init_val</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">tag</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">),</span>
        <span class="n">seg</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">first</span> <span class="o">!=</span> <span class="n">last</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">,</span> <span class="o">++</span><span class="n">first</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">first</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">seg</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">value_type</span> <span class="nf">query</span><span class="p">(</span><span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">seg</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kr">inline</span> <span class="k">static</span> <span class="n">size_type</span> <span class="nf">left</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="k">static</span> <span class="n">size_type</span> <span class="nf">right</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="k">static</span> <span class="n">size_type</span> <span class="nf">mid</span><span class="p">(</span><span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">// idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">seg</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]);</span>
    <span class="p">}</span>

    <span class="c1">// æ‡’æ ‡è®°ä¸‹æ²‰, idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡ [p, r] ç»´æŠ¤åŒºé—´ 0-indexed</span>
    <span class="kt">void</span> <span class="nf">down</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">init_val</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="c1">// å·¦ç»´æŠ¤åŒºé—´ä¸‹æ²‰</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">acc</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]));</span>
        <span class="n">tag</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>

        <span class="c1">// å³ç»´æŠ¤åŒºé—´ä¸‹æ²‰</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">acc</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]));</span>
        <span class="n">tag</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>

        <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_val</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡ [p, r] ç»´æŠ¤åŒºé—´, [x, y] æ›´æ–°åŒºé—´ 0-indexed z å¢é‡</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">x</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">y</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// èŠ‚ç‚¹ç»´æŠ¤åŒºé—´åœ¨æ›´æ–°åŒºé—´èŒƒå›´å†…</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">seg</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">acc</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">val</span><span class="p">));</span>
            <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">val</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// æ‡’æ ‡è®°ä¸‹æ²‰</span>
        <span class="n">down</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æ›´æ–°åŒºé—´å’Œå·¦åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">update</span><span class="p">(</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æ›´æ–°åŒºé—´å’Œå³åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">update</span><span class="p">(</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// å›æº¯</span>
        <span class="n">update</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">value_type</span> <span class="nf">query</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">x</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// èŠ‚ç‚¹ç»´æŠ¤åŒºé—´åœ¨æŸ¥è¯¢åŒºé—´èŒƒå›´å†…</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">)</span> <span class="k">return</span> <span class="n">seg</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>

        <span class="c1">// æ‡’æ ‡è®°ä¸‹æ²‰</span>
        <span class="n">down</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>

        <span class="n">size_type</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="n">value_type</span> <span class="n">res</span> <span class="o">=</span> <span class="n">init_val</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æŸ¥è¯¢åŒºé—´å’Œå·¦åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">query</span><span class="p">(</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æŸ¥è¯¢åŒºé—´å’Œå³åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">query</span><span class="p">(</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

</code></pre></div></div>

<p>ç¬¬ä¸‰æ¬¡å°è£…</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Tp</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">Sequence</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Tp</span><span class="p">&gt;,</span>
    <span class="k">typename</span> <span class="n">Calculate</span> <span class="o">=</span> <span class="n">Max</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;&gt;</span>
<span class="k">class</span> <span class="nc">SegmentTree</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">value_type</span> <span class="n">value_type</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">reference</span> <span class="n">reference</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">const_reference</span> <span class="n">const_reference</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">Sequence</span><span class="o">::</span><span class="n">size_type</span> <span class="n">size_type</span><span class="p">;</span>
    <span class="k">typedef</span> <span class="n">Sequence</span> <span class="n">container_type</span><span class="p">;</span>
<span class="nl">private:</span>
    <span class="k">const</span> <span class="n">value_type</span> <span class="n">init_val</span><span class="p">;</span>
    <span class="c1">//æ‡’æ ‡è®°</span>
    <span class="n">container_type</span> <span class="n">tag</span><span class="p">;</span>
    <span class="c1">//çº¿æ®µæ ‘</span>
    <span class="n">container_type</span> <span class="n">seg</span><span class="p">;</span>
    <span class="n">Calculate</span> <span class="n">cal</span><span class="p">;</span>
<span class="nl">public:</span>
    <span class="k">explicit</span> <span class="n">SegmentTree</span><span class="p">(</span><span class="n">size_type</span> <span class="n">n</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span> <span class="o">=</span> <span class="n">value_type</span><span class="p">())</span>
        <span class="o">:</span> <span class="n">init_val</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">tag</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">),</span> <span class="n">seg</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">explicit</span> <span class="nf">SegmentTree</span><span class="p">(</span><span class="k">const</span> <span class="n">Sequence</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span> <span class="o">=</span> <span class="n">value_type</span><span class="p">())</span>
        <span class="o">:</span> <span class="n">init_val</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">tag</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">),</span> <span class="n">seg</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">size_type</span> <span class="n">n</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="k">for</span><span class="p">(</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">InputIterator</span><span class="p">&gt;</span>
    <span class="k">explicit</span> <span class="nf">SegmentTree</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span> <span class="o">=</span> <span class="n">value_type</span><span class="p">())</span>
        <span class="o">:</span> <span class="n">init_val</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">tag</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">),</span>
        <span class="n">seg</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">first</span> <span class="o">!=</span> <span class="n">last</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">,</span> <span class="o">++</span><span class="n">first</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">first</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">seg</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">value_type</span> <span class="nf">query</span><span class="p">(</span><span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">seg</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kr">inline</span> <span class="k">static</span> <span class="n">size_type</span> <span class="nf">left</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="k">static</span> <span class="n">size_type</span> <span class="nf">right</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="k">static</span> <span class="n">size_type</span> <span class="nf">mid</span><span class="p">(</span><span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">// idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">seg</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]);</span>
    <span class="p">}</span>

    <span class="c1">// æ‡’æ ‡è®°ä¸‹æ²‰, idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡ [p, r] ç»´æŠ¤åŒºé—´ 0-indexed</span>
    <span class="kt">void</span> <span class="nf">down</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">init_val</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="c1">// å·¦ç»´æŠ¤åŒºé—´ä¸‹æ²‰</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">update_seg</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">);</span>
        <span class="n">tag</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">update_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>

        <span class="c1">// å³ç»´æŠ¤åŒºé—´ä¸‹æ²‰</span>
        <span class="n">seg</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">update_seg</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="n">tag</span><span class="p">[</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">update_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">)],</span> <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>

        <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_val</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//idx çº¿æ®µæ ‘èŠ‚ç‚¹ä¸‹æ ‡ [p, r] ç»´æŠ¤åŒºé—´, [x, y] æ›´æ–°åŒºé—´ 0-indexed z å¢é‡</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">x</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">y</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// èŠ‚ç‚¹ç»´æŠ¤åŒºé—´åœ¨æ›´æ–°åŒºé—´èŒƒå›´å†…</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">seg</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">update_seg</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">val</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
            <span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">update_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">val</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// æ‡’æ ‡è®°ä¸‹æ²‰</span>
        <span class="n">down</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æ›´æ–°åŒºé—´å’Œå·¦åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">update</span><span class="p">(</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æ›´æ–°åŒºé—´å’Œå³åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">update</span><span class="p">(</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// å›æº¯</span>
        <span class="n">update</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">value_type</span> <span class="nf">query</span><span class="p">(</span><span class="n">size_type</span> <span class="n">idx</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">x</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// èŠ‚ç‚¹ç»´æŠ¤åŒºé—´åœ¨æŸ¥è¯¢åŒºé—´èŒƒå›´å†…</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">)</span> <span class="k">return</span> <span class="n">seg</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>

        <span class="c1">// æ‡’æ ‡è®°ä¸‹æ²‰</span>
        <span class="n">down</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>

        <span class="n">size_type</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="n">value_type</span> <span class="n">res</span> <span class="o">=</span> <span class="n">init_val</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æŸ¥è¯¢åŒºé—´å’Œå·¦åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">query</span><span class="p">(</span><span class="n">left</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æŸ¥è¯¢åŒºé—´å’Œå³åŠç»´æŠ¤åŒºé—´å­˜åœ¨äº¤é›†</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">query</span><span class="p">(</span><span class="n">right</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="kr">inline</span> <span class="n">Tp</span> <span class="nf">update_tag</span><span class="p">(</span><span class="n">const_reference</span> <span class="n">old</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">nw</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ç´¯ç§¯ç±»å‹: sum, bit_xor, bit_and, bit_or</span>
        <span class="c1">// return cal(old, nw);</span>
        <span class="c1">// è®¾ç½®ç±»å‹: max, min</span>
        <span class="k">return</span> <span class="n">nw</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">static</span> <span class="kr">inline</span> <span class="n">Tp</span> <span class="nf">update_seg</span><span class="p">(</span><span class="n">const_reference</span> <span class="n">old</span><span class="p">,</span> <span class="n">const_reference</span> <span class="n">val</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// sum</span>
        <span class="c1">// return cal(old, (r - p + 1) * val);</span>
        <span class="c1">// bit_xor</span>
        <span class="c1">// return cal(old, ((r - p + 1) &amp; 1) ? val, 0);</span>
        <span class="c1">// bit_and, bit_or</span>
        <span class="c1">// è®¾ç½®ç±»å‹: max, min</span>
        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>]]></content><author><name>Devil</name></author><category term="è®¡ç®—æœº" /><category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" /><category term="æ ‘" /><category term="rmq" /><summary type="html"><![CDATA[é‡æ­¦å™¨ï¼Œæ•ˆç‡ç•¥ä½ï¼Œä½†åŠŸèƒ½å¼ºå¤§ï¼Œå¸¸ç”¨äºè§£å†³å¤æ‚çš„ â€œå•ç‚¹æ›´æ–° + åŒºé—´æŸ¥è¯¢â€ å’Œ â€œåŒºé—´æ›´æ–° + åŒºé—´æŸ¥è¯¢â€ é—®é¢˜ã€‚]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/69.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/69.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">å¼—æ´›ä¼Šå¾·ï¼ˆFloydï¼‰</title><link href="https://xdevil.top/2025/08/21/%E5%BC%97%E6%B4%9B%E4%BC%8A%E5%BE%B7-Floyd.html" rel="alternate" type="text/html" title="å¼—æ´›ä¼Šå¾·ï¼ˆFloydï¼‰" /><published>2025-08-21T00:00:00+00:00</published><updated>2025-08-21T00:00:00+00:00</updated><id>https://xdevil.top/2025/08/21/%E5%BC%97%E6%B4%9B%E4%BC%8A%E5%BE%B7%EF%BC%88Floyd%EF%BC%89</id><content type="html" xml:base="https://xdevil.top/2025/08/21/%E5%BC%97%E6%B4%9B%E4%BC%8A%E5%BE%B7-Floyd.html"><![CDATA[<p>Floyd ç®—æ³•ï¼ˆä¹Ÿç§°ä¸º Floyd-Warshall ç®—æ³•ï¼‰æ˜¯ä¸€ç§éå¸¸ç»å…¸ä¸”ä¼˜é›…çš„<strong>åŠ¨æ€è§„åˆ’</strong>ç®—æ³•ï¼Œç”¨äºè§£å†³<strong>å›¾ä¸­æ‰€æœ‰é¡¶ç‚¹å¯¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„é—®é¢˜</strong>ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡é€æ­¥æ‰©å±•å…è®¸ç»è¿‡çš„ä¸­é—´é¡¶ç‚¹é›†ï¼Œæ¥åŠ¨æ€åœ°æ›´æ–°ä»»æ„ä¸¤ç‚¹é—´çš„æœ€çŸ­è·ç¦»ã€‚</p>

<h1 id="åŠ¨æ€è§„åˆ’åŸç†">åŠ¨æ€è§„åˆ’åŸç†</h1>

<p>ç®—æ³•ä½¿ç”¨ä¸€ä¸ªä¸‰é‡å¾ªç¯æ¥ä¸æ–­æ›´æ–°ä¸€ä¸ªè·ç¦»çŸ©é˜µ <code class="language-plaintext highlighter-rouge">dist</code>ã€‚</p>
<h2 id="çŠ¶æ€å®šä¹‰">çŠ¶æ€å®šä¹‰</h2>
<p><code class="language-plaintext highlighter-rouge">dist[k][i][j]</code>ï¼šè¡¨ç¤ºä»é¡¶ç‚¹ <code class="language-plaintext highlighter-rouge">i</code> åˆ°é¡¶ç‚¹ <code class="language-plaintext highlighter-rouge">j</code> çš„è·¯å¾„ï¼Œç»è¿‡çš„ä¸­é—´ç‚¹é›† <code class="language-plaintext highlighter-rouge">{0, 1, 2, ..., k-1}</code> ï¼ˆä¸åŒ…æ‹¬èµ·ç‚¹å’Œç»ˆç‚¹ï¼‰æ—¶çš„æœ€çŸ­è·¯å¾„é•¿åº¦ã€‚</p>

<h2 id="çŠ¶æ€è½¬ç§»">çŠ¶æ€è½¬ç§»</h2>
<p>å¯¹äºæ¯ä¸€ä¸ªä¸­é—´é¡¶ç‚¹ <code class="language-plaintext highlighter-rouge">k</code>ï¼Œæˆ‘ä»¬è€ƒè™‘æ˜¯å¦é€šè¿‡è¿™ä¸ªæ–°é¡¶ç‚¹ <code class="language-plaintext highlighter-rouge">k</code> èƒ½è®©è·¯å¾„ <code class="language-plaintext highlighter-rouge">i -&gt; j</code> å˜å¾—æ›´çŸ­ <code class="language-plaintext highlighter-rouge">dist[k][i][j] = min(dist[k-1][i][j], dist[k-1][i][k] + dist[k-1][k][j])</code></p>
<ul>
  <li><strong>ä¸ç»è¿‡ <code class="language-plaintext highlighter-rouge">k</code></strong>ï¼šä¿æŒä¸Šä¸€é˜¶æ®µçš„æœ€çŸ­è·¯å¾„ <code class="language-plaintext highlighter-rouge">dist[k-1][i][j]</code>ã€‚</li>
  <li><strong>ç»è¿‡ <code class="language-plaintext highlighter-rouge">k</code></strong>ï¼šå°†è·¯å¾„åˆ†è§£ä¸º <code class="language-plaintext highlighter-rouge">i -&gt; k</code> å’Œ <code class="language-plaintext highlighter-rouge">k -&gt; j</code> ä¸¤æ®µã€‚è¿™ä¸¤æ®µè·¯å¾„åœ¨ä¸Šä¸€é˜¶æ®µ (<code class="language-plaintext highlighter-rouge">k-1</code>) å·²ç»è¢«è®¡ç®—è¿‡ï¼Œå¹¶ä¸”å®ƒä»¬åªä½¿ç”¨äº† <code class="language-plaintext highlighter-rouge">{0, 1, ..., k-1}</code> ä¸­çš„é¡¶ç‚¹ä½œä¸ºä¸­é—´ç‚¹ã€‚</li>
</ul>

<blockquote>
  <p>æ³¨æ„ï¼Œä¸ºå•¥ä¸æ˜¯ <code class="language-plaintext highlighter-rouge">dist[k][i][k] + dist[k][k][j]</code> å‘¢ï¼Ÿ
-<code class="language-plaintext highlighter-rouge">i -&gt; k</code> ç»è¿‡ç‚¹é›† <code class="language-plaintext highlighter-rouge">{0, 1, 2, ..., k-1}</code> çš„æœ€çŸ­è·¯å¾„ å’Œ ç»è¿‡ç‚¹é›† <code class="language-plaintext highlighter-rouge">{0, 1, 2, ..., k-1, k}</code> çš„æœ€çŸ­è·¯å¾„æœ‰å•¥åŒºåˆ«å‘¢ï¼Œæ²¡åŒºåˆ«ï¼</p>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">dist[k][i][k] = dist[k - 1][i][k]</code> , <code class="language-plaintext highlighter-rouge">dist[k][k][j] = dist[k - 1][k][j]</code></li>
  </ul>
</blockquote>

<h2 id="ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦">ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦</h2>
<p>ç”±äº <code class="language-plaintext highlighter-rouge">dist[k][i][j]</code> åªä¾èµ–äº <code class="language-plaintext highlighter-rouge">dist[k-1][...]</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„ <code class="language-plaintext highlighter-rouge">dist[i][j]</code>ï¼Œé€šè¿‡<strong>å°±åœ°æ›´æ–°</strong>ï¼ˆin-placeï¼‰æ¥èŠ‚çœç©ºé—´ï¼Œå°†ä¸‰ç»´DPè¡¨â€œå‹æ‰â€æˆäºŒç»´ã€‚è¿™å°±æ˜¯æˆ‘ä»¬é€šå¸¸è§åˆ°çš„å½¢å¼ã€‚</p>

<p>æœ€ç»ˆçš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹å˜ä¸ºï¼š<code class="language-plaintext highlighter-rouge">if (dist[i][k] + dist[k][j] &lt; dist[i][j]) { dist[i][j] = dist[i][k] + dist[k][j]; }</code></p>

<blockquote>
  <p>æ³¨æ„: æ­¤å¤„çš„ <code class="language-plaintext highlighter-rouge">dist[i][k]</code> å’Œ <code class="language-plaintext highlighter-rouge">dist[k][j]</code> ä¸ä¸€å®šéƒ½æ˜¯ç¬¬ <code class="language-plaintext highlighter-rouge">k - 1</code> é˜¶æ®µçš„ï¼Œä½†ä¸å½±å“è®¡ç®—åŠè¿‡ï¼ˆè¯¦è§çŠ¶æ€è½¬ç§»éƒ¨åˆ†çš„æ³¨æ„ï¼‰</p>
</blockquote>

<h2 id="å¤æ‚åº¦">å¤æ‚åº¦</h2>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š<code class="language-plaintext highlighter-rouge">O(|V|Â³)</code>ã€‚ä¸‰é‡å¾ªç¯ï¼Œéå¸¸ç›´è§‚ã€‚
<strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š<code class="language-plaintext highlighter-rouge">O(|V|Â²)</code>ã€‚åªéœ€è¦å­˜å‚¨ä¸€ä¸ªè·ç¦»çŸ©é˜µã€‚</p>

<h1 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h1>

<p><strong>åˆå§‹åŒ–</strong>ï¼š</p>
<ul>
  <li>åˆ›å»ºä¸€ä¸ª <code class="language-plaintext highlighter-rouge">n x n</code> çš„çŸ©é˜µ <code class="language-plaintext highlighter-rouge">dist</code>ï¼ˆ<code class="language-plaintext highlighter-rouge">n</code> ä¸ºé¡¶ç‚¹æ•°ï¼‰</li>
  <li>å¦‚æœå­˜åœ¨è¾¹ <code class="language-plaintext highlighter-rouge">i -&gt; j</code>ï¼Œåˆ™ <code class="language-plaintext highlighter-rouge">dist[i][j]</code> åˆå§‹åŒ–ä¸ºè¯¥è¾¹çš„æƒé‡</li>
  <li>å¦‚æœ <code class="language-plaintext highlighter-rouge">i == j</code>ï¼Œåˆ™ <code class="language-plaintext highlighter-rouge">dist[i][j] = 0</code>ï¼ˆè‡ªèº«åˆ°è‡ªèº«çš„è·ç¦»ä¸º0ï¼‰</li>
  <li>å¦‚æœä¸å­˜åœ¨è¾¹ <code class="language-plaintext highlighter-rouge">i -&gt; j</code>ï¼Œåˆ™ <code class="language-plaintext highlighter-rouge">dist[i][j]</code> åˆå§‹åŒ–ä¸ºä¸€ä¸ª<strong>æå¤§å€¼</strong>ï¼ˆä¾‹å¦‚ <code class="language-plaintext highlighter-rouge">Infinity</code>ï¼‰ï¼Œä»£è¡¨æ— ç©·å¤§/ä¸å¯è¾¾</li>
</ul>

<p><strong>ä¸‰é‡å¾ªç¯æ›´æ–°</strong>ï¼š</p>
<ul>
  <li>æœ€å¤–å±‚å¾ªç¯ï¼šä¸­é—´é¡¶ç‚¹ <code class="language-plaintext highlighter-rouge">k</code>ï¼Œä» <code class="language-plaintext highlighter-rouge">0</code> åˆ° <code class="language-plaintext highlighter-rouge">n-1</code></li>
  <li>å†…å±‚ä¸¤å±‚å¾ªç¯ï¼šèµ·ç‚¹ <code class="language-plaintext highlighter-rouge">i</code> å’Œç»ˆç‚¹ <code class="language-plaintext highlighter-rouge">j</code>ï¼Œéƒ½ä» <code class="language-plaintext highlighter-rouge">0</code> åˆ° <code class="language-plaintext highlighter-rouge">n-1</code></li>
  <li>å¯¹äºæ¯ä¸€å¯¹ <code class="language-plaintext highlighter-rouge">(i, j)</code>ï¼Œæ£€æŸ¥ <code class="language-plaintext highlighter-rouge">i -&gt; k -&gt; j</code> è¿™æ¡è·¯å¾„æ˜¯å¦æ¯”å½“å‰å·²çŸ¥çš„ <code class="language-plaintext highlighter-rouge">i -&gt; j</code> è·¯å¾„æ›´çŸ­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ›´æ–° <code class="language-plaintext highlighter-rouge">dist[i][j]</code></li>
</ul>

<p><strong>ç»“æœ</strong>ï¼š ç®—æ³•ç»“æŸåï¼Œ<code class="language-plaintext highlighter-rouge">dist[i][j]</code> ä¸­å­˜å‚¨çš„å°±æ˜¯é¡¶ç‚¹ <code class="language-plaintext highlighter-rouge">i</code> åˆ°é¡¶ç‚¹ <code class="language-plaintext highlighter-rouge">j</code> çš„<strong>æœ€çŸ­è·¯å¾„è·ç¦»</strong>ã€‚</p>

<h1 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h1>
<p>å¯ä»¥å¤„ç†<strong>æœ‰å‘å›¾</strong>å’Œ<strong>æ— å‘å›¾</strong>ã€‚</p>

<p>å¯ä»¥å¤„ç†<strong>è´Ÿæƒè¾¹</strong>ã€‚</p>

<p><strong>ä¸èƒ½å¤„ç†åŒ…å«è´Ÿæƒå›è·¯ï¼ˆNegative Cycleï¼‰çš„å›¾</strong>ã€‚å› ä¸ºè´Ÿæƒå›è·¯å¯ä»¥è®©è·¯å¾„é•¿åº¦æ— é™å‡å°ï¼Œä¸å­˜åœ¨æœ€çŸ­è·¯å¾„ã€‚</p>

<h1 id="ä»£ç ">ä»£ç </h1>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//åˆå§‹åŒ–</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">dp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">));</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//w[i][j] ä¸ºæƒé‡</span>
        <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//è®¡ç®—æœ€çŸ­è·ç¦»</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//é»˜è®¤å€¼è®¾ä¸º INT_MAX / 2 é˜²æ­¢è¿™é‡Œæº¢å‡º</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">((</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">dp</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">dp</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="é‡æ„æœ€çŸ­è·¯å¾„">é‡æ„æœ€çŸ­è·¯å¾„??????????</h1>

<p>å¦‚æœéœ€è¦çŸ¥é“å…·ä½“è·¯å¾„è€Œä¸ä»…ä»…æ˜¯è·ç¦»ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">next</code> çŸ©é˜µã€‚</p>
<ol>
  <li><strong>åˆå§‹åŒ– <code class="language-plaintext highlighter-rouge">next</code> çŸ©é˜µ</strong>ï¼š
    <ul>
      <li>å¦‚æœ <code class="language-plaintext highlighter-rouge">i</code> å’Œ <code class="language-plaintext highlighter-rouge">j</code> ä¹‹é—´æœ‰è¾¹ï¼Œåˆ™ <code class="language-plaintext highlighter-rouge">next[i][j] = j</code>ã€‚</li>
      <li>å¦åˆ™ï¼Œ<code class="language-plaintext highlighter-rouge">next[i][j] = None</code>ã€‚</li>
    </ul>
  </li>
  <li><strong>åœ¨æ›´æ–°è·ç¦»æ—¶åŒæ­¥æ›´æ–° <code class="language-plaintext highlighter-rouge">next</code> çŸ©é˜µ</strong>ï¼š
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
    <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
    <span class="nb">next</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>  <span class="c1"># è·¯å¾„èµ°å‘ï¼ši -&gt; ... -&gt; k -&gt; ... -&gt; j
</span></code></pre></div>    </div>
  </li>
  <li><strong>é‡æ„è·¯å¾„</strong>ï¼š
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="nb">next</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">next</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">next</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="n">path</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>
</code></pre></div>    </div>
  </li>
</ol>]]></content><author><name>devil</name></author><category term="å›¾è®º" /><summary type="html"><![CDATA[å¤šæºæœ€çŸ­è·¯å¾„ã€åŠ¨æ€è§„åˆ’]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://xdevil.top/assets/image/68.jpeg" /><media:content medium="image" url="https://xdevil.top/assets/image/68.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>